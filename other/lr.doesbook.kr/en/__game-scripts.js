function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0NFRQFX4G1");pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();const Global=pc.createScript("global");Global.attributes.add("state",{type:"json",schema:[{name:"isDebug",title:"Is Debug",type:"boolean"},{name:"isMobile",type:"boolean",default:!1},{name:"isIos",type:"boolean",default:!1},{name:"allowParticleSystem",type:"boolean",default:!1},{name:"currentZoneIndex",title:"Current Zone Index",type:"number",default:-1}]}),Global.attributes.add("camera",{type:"json",schema:[{name:"entity",title:"Entity",type:"entity"},{name:"cameraIntroPosition",title:"Camera Intro Position",type:"vec3"},{name:"followPlayer",title:"Follow Player",type:"boolean",default:!1},{name:"followPlayerOffset",title:"Follow Player Offset",type:"vec3"},{name:"followPlayerLerpPower",title:"Follow Player Lerp Power",type:"number"},{name:"initOrthoHeight",type:"number"}]}),Global.attributes.add("player",{type:"json",schema:[{name:"entity",title:"Entity",type:"entity"},{name:"enableNavigation",title:"Enable Navigation",type:"boolean",default:!1}]}),Global.attributes.add("managers",{type:"json",schema:[{name:"zoneManager",title:"Zone Manager",type:"entity"},{name:"uiManager",title:"UI Manager",type:"entity"},{name:"soundManager",title:"Sound Manager",type:"entity"}]}),Global.attributes.add("zoneView",{type:"json",schema:[{name:"offset",type:"vec3",default:[-8,12,16]},{name:"lookAtOffsetMobile",type:"vec3",default:[1.4,1,0]},{name:"zoomOffsetMobile",type:"number",default:3},{name:"lookAtOffsetPC",type:"vec3",default:[1.4,1,0]},{name:"zoomOffsetPC",type:"number",default:-1}],array:!0}),Global.prototype.initialize=function(){this.state.isMobile=window.innerWidth<=768,this.state.isIos=pc.platform.ios,this.state.isAndroid=pc.platform.android,this.state.isMac=navigator.userAgent.includes("Mac"),this.state.isInstagram=navigator.userAgent.includes("Instagram"),this.state.isS21=!!window.navigator.userAgent.match(/SM-G991N/i),this.state.isMac&&this.state.isMobile&&!this.state.isAndroid&&(this.state.isIos=!0,this.state.isMac=!1,pc.platform.mobile=!0),this.state.allowParticleSystem=!0,(window.navigator.userAgent.match(/SM-F926N/i)||window.navigator.userAgent.match(/SM-G960N/i)||window.navigator.userAgent.match(/SM-G935F/i)||window.navigator.userAgent.match(/GT-I9500/i)||window.navigator.userAgent.match(/ SM-A730F/i)||window.navigator.userAgent.match(/SM-A520W/i)||window.navigator.userAgent.match(/SM-J260M/i))&&(this.state.allowParticleSystem=!1),this.app.graphicsDevice.maxPixelRatio=pc.platform.mobile?Math.min(window.devicePixelRatio,2):1,this.camera.initOrthoHeight=this.camera.entity.camera.orthoHeight};var SoundManager=pc.createScript("soundManager");SoundManager.attributes.add("fadeDuration",{type:"number",default:1}),SoundManager.attributes.add("positionalSound",{type:"entity"}),SoundManager.prototype.initialize=function(){this.tween=null,this.muted=!1,this.CLIPS=[],this.entity.children.forEach((t=>{let n=t.sound,e=t.sound.slots;for(let t in e){let o={name:t,sound:n,slots:e,slot:e[t],initVolume:e[t].volume};this.CLIPS.push(o)}}));let t=this.positionalSound.sound,n=this.positionalSound.sound.slots;for(let e in n){let o={name:e,sound:t,slots:n,slot:n[e],initVolume:n[e].volume};this.CLIPS.push(o)}},SoundManager.prototype.play=function(t){let n=this.CLIPS.find((n=>n.name===t));n&&(n.slot.isPlaying||n.sound.play(t))},SoundManager.prototype.stop=function(t){let n=this.CLIPS.find((n=>n.name===t));n&&n.slot.isPlaying&&n.sound.stop(t)},SoundManager.prototype.change=function(t,n,e=this.fadeDuration){let o=this.CLIPS.find((n=>n.name===t)),i=this.CLIPS.find((t=>t.name===n));if(i.slot.isPlaying)return;if(!o||!i)return;if(!o.slot||!i.slot)return;this.tween&&this.tween.stop();let s={_current:o.initVolume,_target:0},u={_current:0,_target:i.initVolume};this.play(n),this.tween=this.app.tween(s).to(u,e,pc.SineInOut).on("update",(()=>{o.slot.volume=s._current,i.slot.volume=s._target})).on("complete",(()=>{this.stop(t)})).start()},SoundManager.prototype.toggleSound=function(){this.muted=!this.muted;let t=this.muted?0:1;this.CLIPS.forEach((n=>{n.sound.volume=t}))},SoundManager.prototype.playClip=function(t,n=!0,e=!1){let o=this.CLIPS.find((n=>n.name===t));o&&(n?o.sound.play(t):e?this.app.tween(o.slots[t]).to({volume:0},1,pc.SineInOut).on("complete",(()=>{o.sound.stop(t),o.slot.volume=o.initVolume})).start():o.sound.stop(t))},SoundManager.prototype.changeVolume=function(t,n,e=!1){let o=this.CLIPS.find((n=>n.name===t)),i="default"==n?o.initVolume:n;e?this.app.tween(o.slot).to({volume:i},1,pc.SineInOut).start():o.slot.volume=i},SoundManager.prototype.isPlaying=function(t){let n=this.CLIPS.find((n=>n.name===t));return!!(n.slot.instances.length>0&&n.slot.instances[0].isSuspended)||n.slot.isPlaying},SoundManager.prototype.currentBgm=function(){return this.CLIPS.find((t=>"bgm"===t.name)).slot.isPlaying?"bgm":"bgm2"};const PlayerController=pc.createScript("playerController");PlayerController.attributes.add("appRoot",{type:"entity",title:"App Root Entity"}),PlayerController.attributes.add("playerSpeed",{type:"number",default:0,title:"Player Speed"}),PlayerController.attributes.add("footPrintHolder",{type:"entity"}),PlayerController.attributes.add("light",{type:"entity"}),PlayerController.attributes.add("waitTime",{type:"number",default:5}),PlayerController.attributes.add("autoSpeed",{type:"number",default:4.5}),PlayerController.attributes.add("playerMarkerPositionHolder",{type:"entity"}),PlayerController.attributes.add("playerMarker",{type:"entity"}),PlayerController.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.cameraEntity=this.globalScript.camera.entity,this.soundManager=this.globalScript.managers.soundManager.script.soundManager,this.zoneManager=this.globalScript.managers.zoneManager.script.zoneManager,this.playerModel=this.entity.children[0],this.mouseDown=!1,this.groundShape=new pc.BoundingBox(new pc.Vec3(16.8,0,94),new pc.Vec3(75,.001,125)),this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=this.entity.getLocalPosition().clone(),this.mousePosition=new pc.Vec2,this.debugSpeed=50,this.lastHitPosition=new pc.Vec3,this.initialScale=this.playerModel.getLocalScale().clone(),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))}),this),this.isMoving=!1,this.footPrintRandomRange=1.8,this.footLeft=this.footPrintHolder.children[0].particlesystem,this.footRight=this.footPrintHolder.children[1].particlesystem,this.footLeftPosition=this.footPrintHolder.children[0].getLocalPosition().clone(),this.footRightPosition=this.footPrintHolder.children[1].getLocalPosition().clone(),this.footInitialScale=this.footLeft.scaleGraph.keys[0][1],this.isOnAuto=!1,this.targetIndex=-1,this.timerOn=!1,this.time=0,this.footPrintHolder.enabled=this.globalScript.state.allowParticleSystem},PlayerController.newPosition=new pc.Vec3,PlayerController.prototype.update=function(t){if(this.mouseDown&&this.doRayCast(this.mousePosition),this.direction.lengthSq()>0){let e=this.playerSpeed*t;this.globalScript.state.isDebug&&this.app.keyboard.isPressed(pc.KEY_SHIFT)&&(e=this.debugSpeed*t),this.isOnAuto&&(e=this.autoSpeed*t);let i=PlayerController.newPosition;i.copy(this.direction).scale(e),i.add(this.entity.getPosition()),this.entity.rigidbody.teleport(i),this.entity.rigidbody.type=pc.BODYTYPE_KINEMATIC,this.entity.rigidbody.type=pc.BODYTYPE_DYNAMIC,this.distanceToTravel-=e,this.updateFootPrints(),this.isMoving||(this.soundManager.play("footstep"),this.enableFootPrints(!0),this.isMoving=!0,"run"!=this.playerModel.anim.baseLayer.activeState&&this.playerModel.anim.setTrigger("run"),this.timerOn=!1),this.distanceToTravel<=0&&(this.entity.rigidbody.teleport(i),this.entity.rigidbody.type=pc.BODYTYPE_KINEMATIC,this.entity.rigidbody.type=pc.BODYTYPE_DYNAMIC,this.direction.set(0,0,0),this.isMoving&&(this.soundManager.stop("footstep"),this.enableFootPrints(!1),this.isMoving=!1,"idle"!=this.playerModel.anim.baseLayer.activeState&&this.playerModel.anim.setTrigger("idle"),this.timerOn=!0,this.time=0,this.targetIndex>=0&&(this.targetIndex>=100?(this.app.fire("playerDoneMovingOnDance"),this.needCallback=-1):(this.app.fire("playerDoneMoving",this.targetIndex),this.needCallback=-1))));let o=150,s=175,n=this.playerModel.getPosition().z;if(n>o&&n<s){let t=Utils.map(this.playerModel.getPosition().z,o,s,1,.4),e=this.initialScale.clone();e.mulScalar(t),this.playerModel.setLocalScale(e)}let r=this.playerMarkerPositionHolder.getPosition().y;r=pc.math.clamp(r,1.45,10);let a=this.playerMarker.getPosition().clone();this.playerMarker.setPosition(a.x,r,a.z)}this.timerOn&&this.globalScript.player.enableNavigation&&(this.time+=t,this.time>this.waitTime&&("wait"!=this.playerModel.anim.baseLayer.activeState&&this.playerModel.anim.setTrigger("wait"),this.timerOn=!1,this.time=0))},PlayerController.prototype.movePlayerTo=function(t,e=-1){this.targetPosition.copy(t),this.targetPosition.y=this.entity.getPosition().y,this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.entity.getPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.playerModel.lookAt(this.targetPosition)):this.direction.set(0,0,0),this.targetIndex=e},PlayerController.prototype.enableFootPrints=function(t){if(!this.globalScript.state.allowParticleSystem)return;if(t==this.isMoving)return;let e=this.footRight.rate/2;t?(this.footLeft.play(),this.footRight.play(),this.footRight.emitter.addTime(e,!1)):(this.footLeft.stop(),this.footRight.stop(),this.footRight.emitter.addTime(e,!0))},PlayerController.prototype.updateFootPrints=function(){if(!this.globalScript.state.allowParticleSystem)return;let t=this.playerModel.getLocalEulerAngles().clone();t.y=0==t.z?-t.y-180:t.y,this.footLeft.startAngle!=t.y&&(this.footLeft.onSetSimpleProperty("startAngle",this.footLeft.startAngle,t.y),this.footLeft.onSetSimpleProperty("startAngle2",this.footLeft.startAngle,t.y),this.footRight.onSetSimpleProperty("startAngle",this.footRight.startAngle,t.y),this.footRight.onSetSimpleProperty("startAngle2",this.footRight.startAngle,t.y));let e=pc.math.random(-this.footPrintRandomRange,this.footPrintRandomRange),i=pc.math.random(-this.footPrintRandomRange,this.footPrintRandomRange);this.footPrintHolder.children[0].setLocalPosition(this.footLeftPosition.x+e,this.footLeftPosition.y,e),this.footPrintHolder.children[1].setLocalPosition(this.footRightPosition.x+i,this.footRightPosition.y,i)},PlayerController.prototype.onMouseDown=function(t){t.button==pc.MOUSEBUTTON_LEFT&&(this.mousePosition.x=t.x,this.mousePosition.y=t.y,this.mouseDown=!0)},PlayerController.prototype.onMouseUp=function(){this.mouseDown=!1},PlayerController.prototype.onMouseMove=function(t){this.mousePosition.x=t.x,this.mousePosition.y=t.y},PlayerController.prototype.onTouchStart=function(t){1==t.touches.length&&(this.mousePosition.x=t.touches[0].x,this.mousePosition.y=t.touches[0].y,this.mouseDown=!0,t.event.preventDefault())},PlayerController.prototype.onTouchEnd=function(){this.mouseDown=!1},PlayerController.prototype.onTouchMove=function(t){1==t.touches.length&&this.mouseDown&&(this.mousePosition.x=t.touches[0].x,this.mousePosition.y=t.touches[0].y,t.event.preventDefault())},PlayerController.ray=new pc.Ray,PlayerController.hitPosition=new pc.Vec3,PlayerController.prototype.doRayCast=function(t){if(t.x=pc.math.clamp(t.x,0,window.innerWidth),t.y=pc.math.clamp(t.y,0,window.innerHeight),!this.globalScript.player.enableNavigation)return;let e=PlayerController.ray,i=PlayerController.hitPosition;this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip,e.direction),this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.nearClip,e.origin),e.direction.sub(e.origin).normalize();let o=this.groundShape.intersectsRay(e,i);this.lastHitPosition=i;let s=this.playerModel.getPosition().distance(this.lastHitPosition);o&&s>=.4&&this.movePlayerTo(i)},PlayerController.prototype.rotate=function(t,e=1,i){let o=this.playerModel.clone();o.lookAt(t);let s=this.playerModel.getLocalRotation().clone(),n=o.getLocalRotation().clone(),r={rotation:0};this.app.tween(r).to({rotation:1},e,pc.SineInOut).on("update",(()=>{let t=(new pc.Quat).slerp(s,n,r.rotation);this.playerModel.setLocalRotation(t)})).on("complete",(()=>{this.playerModel.setLocalRotation(n),i&&i()})).start()},PlayerController.prototype.changeAnimation=function(t){this.playerModel.anim.baseLayer.activeState!=t&&this.playerModel.anim.setTrigger(t)},PlayerController.prototype.teleport=function(t){this.entity.rigidbody.teleport(t),this.entity.rigidbody.type=pc.BODYTYPE_KINEMATIC,this.entity.rigidbody.type=pc.BODYTYPE_DYNAMIC,this.targetPosition.set(t.x,t.y,t.z),this.cameraEntity.script.cameraController.teleport(t)},PlayerController.prototype.reset=function(){this.playerModel.setLocalScale(this.initialScale),this.light.script.dynamicLighting.reset()};const SceneManager=pc.createScript("sceneManager");SceneManager.attributes.add("appRoot",{type:"entity",title:"App Root Entity"}),SceneManager.attributes.add("startButtonEntity",{type:"entity"}),SceneManager.attributes.add("arrowEntity",{type:"entity"}),SceneManager.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.uiManager=this.globalScript.managers.uiManager.script.uiManager,this.soundManager=this.globalScript.managers.soundManager.script.soundManager,this.isOnIntro=!1,this._startButton=this.startButtonEntity.button,this._startButton.on("click",(t=>{gtag("event","click",{intro:"intro"}),this.isOnIntro||(this.isOnIntro=!0,this.globalScript.player.entity.children[0].enabled=!0,this.uiManager.showCheckmark(),CameraUtils.initIntroMode(this.app,this.globalScript.camera,this.globalScript.player,4,this.globalScript.player.entity),this.soundManager.playClip("boxCheck"))})),this._startButton.on("mousedown",(function(t){t.stopPropagation()}),this),this._startButton.on("touchstart",(function(t){t.stopPropagation()}),this),this.app.on("closeChoonsikPopup",(()=>{this.arrowEntity.script.maskController.enable(!0),this.soundManager.playClip("floorArrow"),this.globalScript.camera.followPlayer=!0,this.globalScript.player.enableNavigation=!0,this.uiManager.enablePlayerMarker(!0,0),this.globalScript.player.entity.script.playerController.timerOn=!0,this.globalScript.player.entity.script.playerController.time=0})),this.app.on("doneInitIntroMode",(()=>{this.isOnIntro=!1,this.uiManager.showMainUI(),setTimeout((()=>{this.uiManager.openPopup("choonsik")}),2500)}))};var ZoneManager=pc.createScript("zoneManager");ZoneManager.attributes.add("appRoot",{type:"entity",title:"App Root Entity"}),ZoneManager.attributes.add("zoneHolder",{type:"entity"}),ZoneManager.attributes.add("arrowHolder",{type:"entity"}),ZoneManager.attributes.add("textHolder",{type:"entity"}),ZoneManager.attributes.add("distanceThreshold",{type:"number",default:10}),ZoneManager.attributes.add("loadingDistanceThreshold",{type:"number",default:20}),ZoneManager.attributes.add("busMainSprite",{type:"entity"}),ZoneManager.attributes.add("restartPosition",{type:"entity"}),ZoneManager.attributes.add("bathRoomGameUI",{type:"entity"}),ZoneManager.attributes.add("livingRoomGameUI",{type:"entity"}),ZoneManager.attributes.add("bgmChangeTrigger",{type:"entity"}),ZoneManager.attributes.add("catSoundTrigger",{type:"entity"}),ZoneManager.attributes.add("catDistanceThreshold",{type:"number",default:10}),ZoneManager.attributes.add("debugTeleport",{type:"entity"}),ZoneManager.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.playerEntity=this.globalScript.player.entity,this.uiManager=this.globalScript.managers.uiManager.script.uiManager,this.soundManager=this.globalScript.managers.soundManager.script.soundManager,this.zones=[],this.isOnTimeout=!1,this.needPopup=!0,this.popupTargetIndex=0,this.FORWARD=new pc.Vec3(0,0,100),this.XZ=new pc.Vec3(1,0,1),this.bathRoomGameUIController=this.bathRoomGameUI.script.bathroomGameUicontroller,this.bathRoomGameUI.enabled=!0,this.livingRoomGameUIController=this.livingRoomGameUI.script.livingroomGameUicontroller,this.livingRoomGameUI.enabled=!0,this.initZones();for(let e of this.appRoot.findByTag("zoneTransitionButton"))e.button.on("click",(()=>{this.onTransitionButton(e)})),e.button.on("mousedown",(function(e){e.stopPropagation()}),this),e.button.on("touchstart",(function(e){e.stopPropagation()}),this);for(let e of this.appRoot.findByTag("interactionButton"))e.button.on("click",(()=>{this.onInteractionButton(e)})),e.button.on("mousedown",(function(e){e.stopPropagation()}),this),e.button.on("touchstart",(function(e){e.stopPropagation()}),this);this.app.on("closeRyanPopup",(()=>{this.needPopup=!1,this.enableZone(this.popupTargetIndex,!0)})),this.app.on("playerDoneMoving",(e=>{this.updateZone(e)})),this.useBgm=!0},ZoneManager.prototype.update=function(e){this.updateZoneTriggerStatus(),this.globalScript.state.isDebug&&this.updateDebugKeys()},ZoneManager.PrevZPos=0,ZoneManager.prototype.updateZoneTriggerStatus=function(){let e=this.playerEntity.getPosition();for(let t=0;t<this.zones.length;t++){let i=this.zones[t].sprite.getPosition(),o=e.distance(i);if(0!=t)o<=this.loadingDistanceThreshold?this.loadZone(t,!0):this.loadZone(t,!1),o<=this.distanceThreshold?this.zones[t].enabled||this.enableZone(t,!0):this.zones[t].enabled&&this.enableZone(t,!1);else{let i=e.distance(this.busMainSprite.getPosition());o<=this.loadingDistanceThreshold||i<=this.loadingDistanceThreshold?this.loadZone(t,!0):this.loadZone(t,!1),o<=this.distanceThreshold||i<=this.distanceThreshold?this.zones[t].enabled||this.enableZone(t,!0):this.zones[t].enabled&&this.enableZone(t,!1)}}e.z>=this.bgmChangeTrigger.getPosition().z?this.soundManager.isPlaying("bgm2")||ZoneManager.PrevZPos==e.z||this.soundManager.change("bgm","bgm2",1):this.soundManager.isPlaying("bgm")||ZoneManager.PrevZPos==e.z||this.soundManager.change("bgm2","bgm",1),ZoneManager.PrevZPos=e.z,e.distance(this.catSoundTrigger.getPosition())<=this.catDistanceThreshold?(this.catPrevTriggered||this.soundManager.isPlaying("cat")||this.soundManager.playClip("cat"),this.catPrevTriggered=!0):this.catPrevTriggered=!1},ZoneManager.prototype.resetCameraAndPlayer=function(){let e=this.restartPosition.getPosition();this.playerEntity.script.playerController.teleport(e),this.playerEntity.script.playerController.reset(),this.globalScript.camera.entity.script.cameraController.teleport(e),CameraUtils.initDirectFollowMode(this.app,this.globalScript.camera,this.globalScript.player,0),this.zones[4].visited=!1},ZoneManager.prototype.initZones=function(){for(let e=0;e<this.zoneHolder.children.length;e++){let t=this.zoneHolder.children[e];if(this.zones[e]={entity:t,enabled:!1,model:t.children[0],animation:t.children[0].children[0].anim,sprite:t.children[1],text:t.children[2],choonsikExitPosition:t.children[3].getPosition(),bgm:null,visited:null},this.zones[e].model.enabled=!1,this.zones[e].sprite.enabled=!0,this.zones[e].text.enabled=!0,this.zones[e].bgm=t.name,this.zones[e].visited=!1,this.globalScript.state.isMobile){let t=this.zones[e].entity.children[6].getLocalScale(),i=this.zones[e].entity.children[7].getLocalScale();0!=t.x&&(t.x+=.15,t.y+=.15,t.z+=.15),0!=i.x&&(i.x+=.15,i.y+=.15,i.z+=.15)}}},ZoneManager.prototype.loadZone=function(e,t){if(this.zones[e].visited&&this.zones[e].model.enabled!=t&&(this.zones[e].visited&&0==e&&t&&(this.globalScript.state.isDebug&&console.log("revisiting zone 0"),this.zones[e].animation.setTrigger("Loop")),this.zones[e].model.enabled=t,this.globalScript.state.isDebug&&console.log(`update visibility ${t} for zone ${e}`)),this.zones[e].loaded)return;if(!t)return;this.zones[e].loaded=!0;let i=this.app.assets.findByTag("zone-"+e);this.globalScript.state.isDebug&&console.log(`load ${i.length} assets for zone ${e}`);for(let e=0;e<i.length;e++)this.app.assets.load(i[e])},ZoneManager.prototype.enableZone=function(e,t){if(this.globalScript.state.isDebug&&console.log("enable zone",e,t),this.zones[e].enabled=t,t){if(this.needPopup&&0!=e&&4!=e)return this.uiManager.openPopup("ryan"),void(this.popupTargetIndex=e);this.zones[e].visited||(this.zones[e].visited=!0,this.zones[e].model.enabled=!0,this.globalScript.player.entity.script.playerController.movePlayerTo(this.zones[e].choonsikExitPosition,e),this.globalScript.player.enableNavigation=!1,this.uiManager.enablePlayerMarker(!1)),this.globalScript.state.currentZoneIndex=e}else this.globalScript.state.currentZoneIndex=-1},ZoneManager.prototype.resetBathroom=function(){this.zones[3].animation.setTrigger("LoopB"),this.entity.script.fadeMaterialDiffuseTint.updateColor(-1,0)},ZoneManager.prototype.updateZone=function(e){let t=this.globalScript.camera.entity.getPosition().clone().mul(this.XZ);this.playerEntity.script.playerController.rotate(t),4==e&&this.uiManager.loadEndingVideo(),CameraUtils.initZoneFocusMode(this.app,this.globalScript,this.zones[e].model,(()=>{this.playerEntity.script.playerController.changeAnimation("surprise"),this.zones[e].sprite.script.fadeGroup.start(!1),this.globalScript.camera.followPlayer=!1,this.zones[e].animation.setTrigger("In"),this.soundManager.playClip("zoneTransition",!0),1==e?this.soundManager.playClip("zone01-office-ambient"):2==e?this.soundManager.playClip("zone02-living-ambient"):3==e&&this.soundManager.playClip("zone03-bath-ambient"),this.uiManager.enablePlayerMarker(!0,1),setTimeout((()=>{this.uiManager.enablePlayerMarker(!0,2),0!=e&&(this.zones[e].entity.children[6].enabled=!0),this.playerEntity.script.playerController.rotate(this.zones[e].model.getPosition(),.5)}),2e3),0==e?(setTimeout((()=>{this.soundManager.playClip("zone00-door")}),1e3),setTimeout((()=>{this.soundManager.playClip("zone00-bus-in");let t=this.zones[e].entity.children[8].getPosition();this.globalScript.player.entity.script.playerController.isOnAuto=!0,this.globalScript.player.entity.script.playerController.movePlayerTo(t),this.globalScript.camera.entity.script.cameraController.startAnimation(0,(()=>{this.soundManager.change("zone00-bus-in","zone00-bus-loop"),setTimeout((()=>{this.playerEntity.script.playerController.rotate(this.FORWARD,.5)}),1e3),setTimeout((()=>{this.uiManager.enablePlayerMarker(!0,3),this.zones[e].entity.children[7].enabled=!0}),5e3)}))}),3e3)):4==e&&setTimeout((()=>{this.uiManager.enableVisitedZone(e,!1),this.uiManager.openEndingVideo()}),3e3)}),e)},ZoneManager.prototype.onTransitionButton=function(e){let t=e.tags._list[1];if(this.zones[t].model.enabled&&this.zones[t].entity.children[6].enabled){if(e.enabled=!1,this.zones[t].entity.children[5].enabled=!0,this.zones[t].animation.setTrigger("Transition"),this.zones[t].entity.children[6].enabled=!1,this.uiManager.enablePlayerMarker(!0,3),this.soundManager.playClip("zoneTransition",!0),t<this.textHolder.children.length){let e=this.textHolder.children[t];for(let t=0;t<e.children.length;t++)e.children[t].script.maskController.enable(!0,(()=>{this.soundManager.playClip("floorText")}))}1==t?(this.app.root.findByName("Cutout").enabled=!1,this.soundManager.playClip("zone01-ryan-fall")):2==t?this.soundManager.playClip("zone02-racing"):3==t&&(this.soundManager.playClip("zone03-octo"),this.soundManager.changeVolume(this.soundManager.currentBgm(),0,!0)),setTimeout((()=>{this.zones[t].entity.children[7].enabled=!0,1==t?(this.soundManager.playClip("zone01-airplane"),this.soundManager.playClip("zone01-office-ambient",!1)):2==t?(this.entity.script.uvAnimation.start(),this.soundManager.playClip("zone02-living-ambient",!1)):3==t&&this.soundManager.playClip("zone03-bath-ambient",!1),2==t&&this.livingRoomGameUIController.enableGameUI(!0),3==t&&this.bathRoomGameUIController.enableGameUI(!0)}),2e3)}},ZoneManager.prototype.onInteractionButton=function(e){let t=Number(e.tags._list[1]);this.isOnTimeout||"LoopB"==this.zones[t].animation.baseLayer.activeState&&(0==t&&this.soundManager.change("zone00-bus-loop","zone00-bus-out"),2==t&&this.livingRoomGameUIController.enableGameUI(!1),3==t&&this.bathroomClicked(),3!=t&&this.zones[t].animation.setTrigger("Interaction"),0!=t&&(this.zones[t].model.children[1].enabled=!0),this.globalScript.camera.followPlayer||(3!=t&&this.resetCameraToFollowMode(t),0==t&&setTimeout((()=>{this.globalScript.player.entity.script.playerController.isOnAuto=!1,this.globalScript.player.entity.script.playerAnimationController.startAnimation(0)}),1e3)))},ZoneManager.prototype.resetCameraToFollowMode=function(e){this.isOnTimeout=!0,this.uiManager.enablePlayerMarker(!0,4);let t=3500;0==e&&(t=4e3),3==e&&(t=7e3),setTimeout((()=>{CameraUtils.initFollowMode(this.app,this.globalScript.camera,this.globalScript.player,2,(()=>{e+1<this.arrowHolder.children.length&&this.arrowHolder.children[e+1].script.maskController.enable(!0,(()=>{this.soundManager.playClip("floorArrow")})),this.uiManager.enableVisitedZone(e),this.uiManager.enablePlayerMarker(!0,0),this.playerEntity.script.playerController.rotate(this.zones[e].choonsikExitPosition.clone().add(this.FORWARD)),this.isOnTimeout=!1,0==e&&(this.zones[e].model.children[1].enabled=!0),0!=e&&(this.zones[e].entity.children[7].enabled=!1)}))}),t),0==e&&(this.zones[e].entity.children[7].enabled=!1)},ZoneManager.prototype.bathroomClicked=function(){let e=this.zones[3].animation;if("LoopB"!=e.baseLayer.activeState)return;if(this.bathRoomGameUIController.attackCount>=this.bathRoomGameUIController.maxAttackCount)return;let t=this.bathRoomGameUIController.attackCount%4;2==t?(e.setTrigger("OctoAttack"),this.bathRoomGameUIController.octoAttack()):(0==t&&(e.setTrigger("RyanAttackA"),this.entity.script.fadeMaterialDiffuseTint.updateColor(0,1500)),1==t&&(e.setTrigger("RyanAttackB"),this.entity.script.fadeMaterialDiffuseTint.updateColor(1,1500)),3==t&&(e.setTrigger("RyanAttackC"),this.entity.script.fadeMaterialDiffuseTint.updateColor(2,1500)),this.bathRoomGameUIController.playerAttack()),this.bathRoomGameUIController.attackCount>=this.bathRoomGameUIController.maxAttackCount&&(this.bathRoomGameUIController.win(),this.globalScript.camera.followPlayer||this.resetCameraToFollowMode(3))},ZoneManager.prototype.updateDebugKeys=function(){this.app.keyboard.wasPressed(pc.KEY_R)?(this.initialize(),CameraUtils.initFollowMode(this.app,this.globalScript.camera,this.globalScript.player,2,(()=>{this.globalScript.camera.entity.camera.orthoHeight=10}))):this.app.keyboard.wasPressed(pc.KEY_0)?this.globalScript.player.entity.script.playerController.teleport(this.debugTeleport.children[0].getPosition()):this.app.keyboard.wasPressed(pc.KEY_1)?this.globalScript.player.entity.script.playerController.teleport(this.debugTeleport.children[1].getPosition()):this.app.keyboard.wasPressed(pc.KEY_2)?this.globalScript.player.entity.script.playerController.teleport(this.debugTeleport.children[2].getPosition()):this.app.keyboard.wasPressed(pc.KEY_3)?this.globalScript.player.entity.script.playerController.teleport(this.debugTeleport.children[3].getPosition()):this.app.keyboard.wasPressed(pc.KEY_4)&&this.globalScript.player.entity.script.playerController.teleport(this.debugTeleport.children[4].getPosition())},ZoneManager.prototype.getCompassTarget=function(){for(let e=0;e<this.zones.length;e++)if(!this.zones[e].visited)return{index:e,position:this.zones[e].sprite.getPosition()};return{index:1,position:this.zones[4].sprite.getPosition()}},ZoneManager.prototype.getVisitedZone=function(){let e=[];for(let t=1;t<this.zones.length;t++)this.zones[t].visited&&e.push(t);return{count:e.length,index:e}};var UiManager=pc.createScript("uiManager");UiManager.attributes.add("appRoot",{type:"entity",title:"App Root Entity"}),UiManager.attributes.add("uiScreenPC",{type:"entity"}),UiManager.attributes.add("uiScreenMobile",{type:"entity"}),UiManager.attributes.add("popupCommon",{type:"entity"}),UiManager.attributes.add("popupChoonsik",{type:"entity"}),UiManager.attributes.add("popupRyan",{type:"entity"}),UiManager.attributes.add("endingScreenPC",{type:"entity"}),UiManager.attributes.add("endingScreenMobile",{type:"entity"}),UiManager.attributes.add("endingScreenMobile2",{type:"entity"}),UiManager.attributes.add("endingScreenMobile3",{type:"entity"}),UiManager.attributes.add("downloadButtonPC",{type:"entity"}),UiManager.attributes.add("downloadButtonMobile",{type:"entity"}),UiManager.attributes.add("introCheckmark",{type:"entity"}),UiManager.attributes.add("introClickLabel",{type:"entity"}),UiManager.attributes.add("playerMarker",{type:"entity"}),UiManager.attributes.add("compass",{type:"entity"}),UiManager.attributes.add("compassDuration",{type:"number",default:2}),UiManager.attributes.add("flowerParticle",{type:"entity"}),UiManager.attributes.add("flowerParticleTrigger",{type:"entity"}),UiManager.attributes.add("flowerParticleDistance",{type:"number",default:20}),UiManager.attributes.add("textures",{type:"json",schema:[{name:"zoneVisited",type:"asset",assetType:"texture"},{name:"soundOn",type:"asset",assetType:"texture"},{name:"soundOff",type:"asset",assetType:"texture"}]}),UiManager.attributes.add("links",{type:"json",schema:[{name:"download",type:"string",default:"https://www.choonsikdiary.com/onoffkit.zip"},{name:"downloadIos",type:"string",default:"https://www.choonsikdiary.com/ios/onoffkit.zip"},{name:"downloadIosInstagram",type:"string",default:"https://drive.google.com/drive/folders/1XT-TzsVg06UEABhyUT_ZCb5ihKjHRv7I?usp=sharing"},{name:"twitter",type:"string",default:"https://twitter.com/Choonsik_diary"},{name:"youtube",type:"string",default:"https://www.youtube.com/c/KakaoFriendsofficial"},{name:"copy",type:"string",default:"https://www.choonsikdiary.com"}]}),UiManager.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.zoneManager=this.globalScript.managers.zoneManager.script.zoneManager,this.soundManager=this.globalScript.managers.soundManager.script.soundManager,this.player=this.globalScript.player.entity,this.showCompass=!1,this.compassTime=0,this.compassTargetPosition=new pc.Vec3,this.flowerParticleEnabled=!1,this.potatoClearInitPosition=new pc.Vec3,this.initMainUI(),this.initPopup(),this.iniEndingUI(),this.initParticle(),this.initBack(),this.initCompass(),this.initSound(),Kakao.init("ddaac11093697c273befd85f0725e3e8"),window.addEventListener("resize",function(t){this.onResized()}.bind(this))},UiManager.prototype.update=function(t){this.showCompass&&this.updateCompass(t),this.updateflowerParticle()},UiManager.prototype.initMainUI=function(){let t=this.globalScript.state.isMobile?this.uiScreenMobile:this.uiScreenPC;this.compassButton=t.children[0],this.visitedZoneHolder=t.children[1],this.soundButton=t.children[2],this.backButton=t.children[3],this.potatoClear=this.visitedZoneHolder.children[4],this.potatoClearInitPosition=this.potatoClear.getLocalPosition().clone(),this.switchToKR=this.uiScreenPC.children[6],this.switchToKR.button.on("click",(t=>{location.href="https://choonsikdiary.com/"})),this.switchToKRmobile=this.uiScreenMobile.children[4],this.switchToKRmobile.button.on("click",(t=>{location.href="https://choonsikdiary.com/"})),this.uiScreenMobile.enabled=this.globalScript.state.isMobile,this.uiScreenPC.enabled=!this.globalScript.state.isMobile,this.compassButton.enabled=!1,this.visitedZoneHolder.enabled=!1,this.soundButton.enabled=!0,this.backButton.enabled=!1,this.backButtonInitPosition=this.backButton.getPosition(),this.soundButtonInitPosition=this.soundButton.getPosition()},UiManager.prototype.showMainUI=function(){this.compassButton.enabled=!0,this.visitedZoneHolder.enabled=!0,this.soundButton.enabled=!0},UiManager.prototype.initPopup=function(){this.popupCommon.children[1].button.on("click",(t=>{this.popupChoonsik.enabled?(this.app.fire("closeChoonsikPopup"),this.popupChoonsik.children[0].script.uiSpriteAnimation.stop()):this.popupRyan.enabled&&(this.app.fire("closeRyanPopup"),this.popupRyan.children[0].script.uiSpriteAnimation.stop()),this.popupCommon.script.fadeGroup.start(!1),this.popupChoonsik.script.fadeGroup.start(!1),this.popupRyan.script.fadeGroup.start(!1)})),this.popupCommon.script.fadeGroup.start(!1,0),this.popupChoonsik.script.fadeGroup.start(!1,0),this.popupRyan.script.fadeGroup.start(!1,0)},UiManager.prototype.openPopup=function(t){this.popupCommon.script.fadeGroup.start(!0),"choonsik"==t?this.popupChoonsik.script.fadeGroup.start(!0):"ryan"==t&&this.popupRyan.script.fadeGroup.start(!0)},UiManager.prototype.iniEndingUI=function(){this.globalScript.state.isMobile?(this.endingMain=this.endingScreenMobile.children[0],this.endingOption=this.endingScreenMobile.children[1],this.urlPopup=this.endingScreenMobile.children[2],this.endingBackground=this.endingScreenMobile2.children[0],this.endingInfo=this.endingScreenMobile2.children[1],this.endingVideo=this.endingScreenMobile3.children[0],this.endingBackgroundIcon=this.endingOption.children[0],this.endingIntro=this.endingOption.children[1],this.endingStamp=this.endingOption.children[2],this.endingNoStamp=this.endingOption.children[3],this.endingInfoDownloadButton=this.downloadButtonMobile):(this.endingBackground=this.endingScreenPC.children[0],this.endingVideo=this.endingScreenPC.children[1],this.endingMain=this.endingScreenPC.children[2],this.endingOption=this.endingScreenPC.children[3],this.endingInfo=this.endingScreenPC.children[4],this.urlPopup=this.endingScreenPC.children[5],this.endingBackgroundIcon=this.endingOption.children[0],this.endingIntro=this.endingOption.children[1],this.endingStamp=this.endingOption.children[2],this.endingNoStamp=this.endingOption.children[3],this.endingInfoDownloadButton=this.downloadButtonPC),this.endingScreenMobile.enabled=this.globalScript.state.isMobile,this.endingScreenMobile2.enabled=this.globalScript.state.isMobile,this.endingScreenMobile3.enabled=this.globalScript.state.isMobile,this.endingScreenPC.enabled=!this.globalScript.state.isMobile,this.endingBackground.script.fadeGroup.start(!1,0),this.endingVideo.script.fadeGroup.start(!1,0),this.endingMain.script.fadeGroup.start(!1,0),this.endingInfo.script.fadeGroup.start(!1,0),this.urlPopup.script.fadeGroup.start(!1,0),this.endingOption.enabled=!0,this.endingBackgroundIcon.script.fadeGroup.start(!1,0),this.endingIntro.script.fadeGroup.start(!1,0),this.endingStamp.script.fadeGroup.start(!1,0),this.endingNoStamp.script.fadeGroup.start(!1,0),this.app.on("endingVideoDone",(()=>{this.endingVideo.children[0].script.videoTexture.start(!1),this.endingVideo.script.fadeGroup.start(!1),this.openEndingPopup()})),this.endingInfo.children[1].button.on("click",(t=>{this.backButton.enabled=!0,this.soundButton.enabled=!0,this.endingInfo.script.fadeGroup.start(!1),this.endingMain.script.fadeGroup.start(!0)})),this.endingInfoDownloadButton.button.on("click",(t=>{gtag("event","click",{download_onoffkit:"download_onoffkit"});let i=document.createElement("a");this.globalScript.state.isAndroid?(i.href=this.links.download,i.download="onoffkit.zip"):this.globalScript.state.isIos?this.globalScript.state.isInstagram?(i.target="_blank",i.href=this.links.downloadIosInstagram):(i.href=this.links.downloadIos,i.download="onoffkit.zip"):this.globalScript.state.isMac?(i.href=this.links.downloadIos,i.download="onoffkit.zip"):(i.href=this.links.download,i.download="onoffkit.zip"),i.click(),i.remove(),this.backButton.enabled=!0,this.soundButton.enabled=!0,this.endingInfo.script.fadeGroup.start(!1),this.endingMain.script.fadeGroup.start(!0)})),this.endingMain.children[3].button.on("click",(t=>{gtag("event","click",{cta_youtube:"cta_youtube"});let i=document.createElement("a");i.target="_blank",i.href=this.links.youtube,i.click()})),this.endingMain.children[4].button.on("click",(t=>{gtag("event","click",{cta_twitter:"cta_twitter"});let i=document.createElement("a");i.target="_blank",i.href=this.links.twitter,i.click()})),this.endingMain.children[5].button.on("click",(t=>{this.urlPopupTimer||(navigator.clipboard.writeText(this.links.copy).catch((t=>{const i=document.createElement("textarea");document.body.appendChild(i),i.value=this.links.copy,i.select(),document.execCommand("copy"),document.body.removeChild(i)})),this.urlPopup.script.fadeGroup.start(!0),this.urlPopupTimer=setTimeout((()=>{this.urlPopup.script.fadeGroup.start(!1),this.urlPopupTimer=null}),2e3))}))},UiManager.prototype.loadEndingVideo=function(){this.endingVideo.enabled=!0,this.endingVideo.children[0].enabled=!0},UiManager.prototype.openEndingVideo=function(){if(this.isOnEnding={status:!0,step:"video"},this.flowerParticle.enabled=!1,this.backButton.element.color=pc.Color.WHITE,this.backButton.children[0].element.color=pc.Color.WHITE,this.soundButton.element.color=pc.Color.WHITE,this.switchToKR.element.color=pc.Color.WHITE,this.switchToKRmobile.element.color=pc.Color.WHITE,!this.globalScript.state.isMobile){let t=this.uiScreenPC.children[5].children[0].getPosition();this.backButton.setPosition(t.x,t.y,t.z);let i=this.uiScreenPC.children[5].children[1].getPosition();this.soundButton.setPosition(i.x,i.y,i.z)}this.compassButton.enabled=!1,this.visitedZoneHolder.enabled=!1,this.backButton.enabled=!0,this.enableCompass(!1),this.playerMarker.enabled=!1,this.endingBackground.script.fadeGroup.start(!0),this.endingVideo.script.fadeGroup.start(!0),this.endingVideo.children[0].script.videoTexture.start(!0)},UiManager.prototype.openEndingPopup=function(){if(this.isOnEnding={status:!0,step:"main"},!this.globalScript.state.isMobile){let t=this.uiScreenPC.children[4].children[0].getPosition();this.backButton.setPosition(t.x,t.y,t.z);let i=this.uiScreenPC.children[4].children[1].getPosition();this.soundButton.setPosition(i.x,i.y,i.z)}this.compassButton.enabled=!1,this.visitedZoneHolder.enabled=!1,this.backButton.enabled=!0,this.enableCompass(!1),this.playerMarker.enabled=!1,this.endingBackground.script.fadeGroup.start(!0),this.endingIntro.script.fadeGroup.start(!0),this.endingBackgroundIcon.script.fadeGroup.start(!0),this.endingPopupTimeout=setTimeout((()=>{this.endingIntro.script.fadeGroup.start(!1),this.endingMain.script.fadeGroup.start(!0);let t=this.zoneManager.getVisitedZone(),i=this.endingMain.children[2];for(const e of t.index)i.children[e-1].element.texture=this.textures.zoneVisited.resource;4==t.count?this.endingStamp.script.fadeGroup.start(!0):this.endingNoStamp.script.fadeGroup.start(!0)}),5e3)},UiManager.prototype.initParticle=function(){this.flowerParticle.enabled=!0,this.flowerParticle.particlesystem.emitter.material.depthTest=!1},UiManager.prototype.updateflowerParticle=function(){this.player.getPosition().clone().distance(this.flowerParticleTrigger.getPosition())<this.flowerParticleDistance?this.flowerParticleEnabled||(this.flowerParticle.enabled=!0,this.flowerParticleEnabled=!0,this.flowerParticle.particlesystem.reset(),this.flowerParticle.particlesystem.play()):this.flowerParticleEnabled&&(this.flowerParticleEnabled=!1,this.flowerParticle.particlesystem.stop())},UiManager.prototype.initBack=function(){this.backButton.button.on("click",(t=>{this.isOnEnding={status:!1,step:"none"},this.backButton.element.color=pc.Color.BLACK,this.backButton.children[0].element.color=pc.Color.BLACK,this.soundButton.element.color=pc.Color.BLACK,this.globalScript.state.isMobile||(this.backButton.setPosition(this.backButtonInitPosition.x,this.backButtonInitPosition.y,this.backButtonInitPosition.z),this.soundButton.setPosition(this.soundButtonInitPosition.x,this.soundButtonInitPosition.y,this.soundButtonInitPosition.z)),this.endingPopupTimeout&&clearTimeout(this.endingPopupTimeout),this.endingVideo.script.fadeGroup.start(!1),this.endingVideo.children[0].script.videoTexture.start(!1),this.zoneManager.resetCameraAndPlayer(),this.endingBackground.script.fadeGroup.start(!1),this.endingVideo.script.fadeGroup.start(!1),this.endingMain.script.fadeGroup.start(!1),this.urlPopup.script.fadeGroup.start(!1),this.endingInfo.script.fadeGroup.start(!1),this.endingBackgroundIcon.script.fadeGroup.start(!1),this.endingIntro.script.fadeGroup.start(!1),this.endingStamp.script.fadeGroup.start(!1),this.endingNoStamp.script.fadeGroup.start(!1),this.backButton.enabled=!1,this.urlPopupTimer&&(clearTimeout(this.urlPopupTimer),this.urlPopupTimer=null),this.showMainUI(!0),this.enablePlayerMarker(!0,0),this.soundManager.isPlaying("bgm")||this.soundManager.change("bgm2","bgm")}))},UiManager.prototype.onResized=function(){if(!this.globalScript.state.isMobile&&this.isOnEnding&&this.isOnEnding.status&&"none"!=this.isOnEnding.step){let t="main"==this.isOnEnding.step?4:5,i=this.uiScreenPC.children[t].children[0].getPosition();this.backButton.setPosition(i.x,i.y,i.z);let e=this.uiScreenPC.children[t].children[1].getPosition();this.soundButton.setPosition(e.x,e.y,e.z)}},UiManager.prototype.showCheckmark=function(){this.introCheckmark.sprite.frame=11,this.introClickLabel.script.blinking.stop()},UiManager.prototype.enablePlayerMarker=function(t,i=0){t&&(this.playerMarker.sprite.frame=i),this.playerMarker.enabled=t},UiManager.prototype.initCompass=function(){this.compassButton.button.on("click",(t=>{this.globalScript.player.enableNavigation&&0==this.compassTime&&(this.compassTargetPosition=this.zoneManager.getCompassTarget().position,this.compassTargetPosition&&this.enableCompass(!0))}))},UiManager.prototype.enableCompass=function(t){this.showCompass=t,this.compass.enabled=t,this.compassTime=0,this.playerMarker.enabled=!t},UiManager.prototype.updateCompass=function(t){this.compassTime+=t,this.compassTime>=this.compassDuration&&this.enableCompass(!1);let i=this.player.getPosition().clone().sub(this.compassTargetPosition),e=Math.atan2(i.z,i.x)*pc.math.RAD_TO_DEG;this.compass.setLocalEulerAngles(0,0,e)},UiManager.prototype.enableVisitedZone=function(t,i=!0){t<1||0==this.visitedZoneHolder.children[t-1].element.spriteFrame&&(i?(this.soundManager.playClip("zoneVisited",!0),this.showPotatoClear(t)):this.visitedZoneHolder.children[t-1].element.spriteFrame=8)},UiManager.prototype.showPotatoClear=function(t){let i=this.visitedZoneHolder.children[t-1],e=i.getLocalPosition().clone();i.script.fadeGroup.start(!1),this.potatoClear.setLocalPosition(this.potatoClearInitPosition),this.potatoClear.script.fadeGroup.start(!0,0),this.potatoClear.script.uiSpriteAnimation.play(!0),this.potatoClear.tween(this.potatoClear.getLocalPosition()).to({x:e.x,y:e.y,z:e.z},.5,pc.SineInOut).delay(1).on("complete",(()=>{setTimeout((()=>{i.element.spriteFrame=8,i.script.fadeGroup.start(!0),this.potatoClear.script.fadeGroup.start(!1,1)}),3e3)})).start()},UiManager.prototype.initSound=function(){this.soundButton.element.texture=this.textures.soundOn.resource,this.soundButton.button.on("click",(t=>{this.soundManager.toggleSound(),this.soundButton.element.texture=this.soundManager.muted?this.textures.soundOff.resource:this.textures.soundOn.resource}))};const DynamicLighting=pc.createScript("dynamicLighting");DynamicLighting.attributes.add("appRoot",{type:"entity",title:"App Root Entity"}),DynamicLighting.attributes.add("floorEntity",{type:"entity",title:"Floor Entity"}),DynamicLighting.attributes.add("floorTints",{type:"rgb",array:!0}),DynamicLighting.attributes.add("playerTints",{type:"rgb",array:!0}),DynamicLighting.attributes.add("lightColors",{type:"rgb",array:!0}),DynamicLighting.attributes.add("zRanges",{type:"vec2",array:!0}),DynamicLighting.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.r=new pc.Color,this.lastPlayerPosition=new pc.Vec3,this.reset()},DynamicLighting.playerPosition=new pc.Vec3,DynamicLighting.prototype.update=function(){if(DynamicLighting.playerPosition=this.globalScript.player.entity.getPosition(),DynamicLighting.playerPosition.z!=this.lastPlayerPosition.z){this.lastPlayerPosition=DynamicLighting.playerPosition.clone();let t=-1,i=this.lastPlayerPosition.z;if(i>=this.zRanges[0].x&&i<=this.zRanges[0].y&&(t=0),i>=this.zRanges[1].x&&i<=this.zRanges[1].y&&(t=1),i>=this.zRanges[2].x&&i<=this.zRanges[2].y&&(t=2),i>=this.zRanges[3].x&&i<=this.zRanges[3].y&&(t=3),-1==t)return;let e=this.lightColors[t],n=this.lightColors[Math.min(t+1,this.zRanges.length-1)],s=this.zRanges[t].x,r=this.zRanges[t].y,a=Utils.map(DynamicLighting.playerPosition.z,s,r,0,1);if(this.entity.light.color=this.r.lerp(e,n,a),3==t){let t=this.r.lerp(this.floorTints[0],this.floorTints[1],a);this.floorEntity.render.meshInstances[0].setParameter("material_diffuse",[t.r,t.g,t.b]),this.floorEntity.render.meshInstances[0].material.update();let i=this.r.lerp(this.floorTints[0],this.floorTints[1],a);this.globalScript.player.entity.children[0].children[0].children[0].render.meshInstances[0].setParameter("material_diffuse",[i.r,i.g,i.b]),this.globalScript.player.entity.children[0].children[0].children[0].render.meshInstances[0].material.update()}}},DynamicLighting.prototype.reset=function(){this.entity.light.color=this.lightColors[0],this.floorEntity.render.meshInstances[0].setParameter("material_diffuse",[this.floorTints[0].r,this.floorTints[0].g,this.floorTints[0].b]),this.floorEntity.render.meshInstances[0].material.update(),this.globalScript.player.entity.children[0].children[0].children[0].render.meshInstances[0].setParameter("material_diffuse",[this.playerTints[0].r,this.playerTints[0].g,this.playerTints[0].b]),this.globalScript.player.entity.children[0].children[0].children[0].render.meshInstances[0].material.update()};var SpriteAnimationController=pc.createScript("spriteAnimationController");SpriteAnimationController.attributes.add("appRoot",{type:"entity",title:"App Root Entity"}),SpriteAnimationController.attributes.add("materialAsset",{type:"asset",assetType:"material"}),SpriteAnimationController.attributes.add("shadowMaterialAsset",{type:"asset",assetType:"material"}),SpriteAnimationController.attributes.add("triggerDistance",{type:"number",default:1}),SpriteAnimationController.attributes.add("amplitude",{type:"number",default:.05}),SpriteAnimationController.attributes.add("wavelength",{type:"number",default:1}),SpriteAnimationController.attributes.add("emissiveColor",{type:"rgba"}),SpriteAnimationController.attributes.add("shadowFalloff",{type:"number",default:1}),SpriteAnimationController.attributes.add("shadowColor",{type:"rgba"}),SpriteAnimationController.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.player=this.globalScript.player.entity,this.material=this.materialAsset.resource,this.shadowMaterial=this.shadowMaterialAsset.resource,this.time=0,this.materialInitialized=!1,this.updateMaterial()},SpriteAnimationController.prototype.update=function(t){let e=this.isTriggered(),a=this.isCycleReset();!e&&a||(this.time+=t,this.updateMaterial())},SpriteAnimationController.prototype.isTriggered=function(){for(let t=0;t<this.entity.children.length;t++){if(this.entity.children[t].getPosition().distance(this.player.getPosition())<this.triggerDistance)return!0}return!1},SpriteAnimationController.prototype.isCycleReset=function(){let t=Math.sin(this.time*this.wavelength)*this.amplitude;return Math.abs(t)<=.005},SpriteAnimationController.prototype.initializeMaterial=function(){let t="uniform sampler2D texture_opacityMap;\nuniform vec2 offset;\nuniform vec2 tiling;\nuniform float time;\nuniform float amplitude;\nuniform float wavelength;\nuniform vec4 emissiveColor;\nuniform bool isShadow;\nuniform float shadowFalloff;\nuniform vec4 shadowColor;\n\nvoid getOpacity() {\n    vec2 uv = $UV;\n    float skew = sin(time * wavelength) * amplitude;\n    uv.x += skew * pow( 1.0 - offset.y - uv.y, 2.0);\n\n    if(isShadow) {\n       float alpha = texture2D(texture_opacityMap, uv).$CH;\n       if(alpha < 0.5) discard;\n\n       float y = 1.0 - uv.y;\n       float min = offset.y;\n       float max = offset.y + tiling.y;\n\n       float falloffValue = (min <= y && y < max) ? y : offset.y;\n       falloffValue = (falloffValue - min) / (max - min);\n       falloffValue = clamp(pow(falloffValue, shadowFalloff), 0.0, 1.0);\n       falloffValue = mix(alpha, 0.0, falloffValue);\n\n       dAlpha = mix(0.0, 1.0, falloffValue * shadowColor.w); \n    }\n    else {\n       dAlpha = texture2D(texture_opacityMap, uv).$CH;\n    }\n}\n\n",e="uniform sampler2D texture_emissiveMap;\n\nvec3 getEmission() {\n    vec2 uv = $UV;\n    float skew = sin(time * wavelength) * amplitude;\n    uv.x += skew * pow( 1.0 - offset.y - uv.y, 2.0);\n\n    if(isShadow) {\n       return shadowColor.xyz;\n    }\n    else {\n       return $texture2DSAMPLE(texture_emissiveMap, uv).$CH * emissiveColor.xyz;\n    }\n}\n\n";this.material.chunks.opacityPS=t,this.material.chunks.emissivePS=e,this.shadowMaterial.chunks.opacityPS=t,this.shadowMaterial.chunks.emissivePS=e,this.materialInitialized=!0},SpriteAnimationController.prototype.updateMaterial=function(){this.materialInitialized||this.initializeMaterial(),this.material.setParameter("time",this.time),this.material.setParameter("offset",this.material.emissiveMapOffset.data),this.material.setParameter("tiling",this.material.emissiveMapTiling.data),this.material.setParameter("amplitude",this.amplitude),this.material.setParameter("wavelength",this.wavelength),this.material.setParameter("emissiveColor",this.emissiveColor.data),this.material.setParameter("isShadow",!1),this.material.setParameter("shadowFalloff",this.shadowFalloff),this.material.setParameter("shadowColor",this.shadowColor.data),this.material.update(),this.shadowMaterial.setParameter("time",this.time),this.shadowMaterial.setParameter("offset",this.shadowMaterial.emissiveMapOffset.data),this.shadowMaterial.setParameter("tiling",this.shadowMaterial.emissiveMapTiling.data),this.shadowMaterial.setParameter("amplitude",this.amplitude),this.shadowMaterial.setParameter("wavelength",this.wavelength),this.shadowMaterial.setParameter("emissiveColor",this.emissiveColor.data),this.shadowMaterial.setParameter("isShadow",!0),this.shadowMaterial.setParameter("shadowFalloff",this.shadowFalloff),this.shadowMaterial.setParameter("shadowColor",this.shadowColor.data)};var CameraController=pc.createScript("cameraController");CameraController.attributes.add("appRoot",{type:"entity",title:"App Root Entity"}),CameraController.attributes.add("cameraPathHolder",{type:"entity"}),CameraController.attributes.add("duration",{type:"number",default:10}),CameraController.attributes.add("cameraClampX",{type:"vec2"}),CameraController.attributes.add("cameraClampZ",{type:"vec2"}),CameraController.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.playerEntity=this.globalScript.player.entity,this.playerController=this.globalScript.player.entity.script.playerController,this.callback=null,this.newCamPos=new pc.Vec3,this.lerpCamPos=new pc.Vec3,this.camPos=new pc.Vec3,this.time=0,this.isAnimating=!1,this.pathRoot=null,this.pathData=null,this.up=new pc.Vec3,this.lookAt=new pc.Vec3},CameraController.prototype.update=function(t){this.globalScript.camera.followPlayer&&this.moveCameraToPlayer(t),this.isAnimating&&this.updateAnimation(t)},CameraController.prototype.moveCameraToPlayer=function(t){let a=this.playerEntity.getPosition().clone(),i=this.playerEntity.script.playerController.targetPosition.clone();i.x=pc.math.clamp(i.x,a.x-3.75,a.x+3.75),i.z=pc.math.clamp(i.z,a.z-5,a.z+5),this.newCamPos.set(0,0,0).add2(i,this.globalScript.camera.followPlayerOffset),this.lerpCamPos.lerp(this.entity.getPosition(),this.newCamPos,this.globalScript.camera.followPlayerLerpPower*t);let e=pc.math.clamp(this.lerpCamPos.x,this.cameraClampX.x,this.cameraClampX.y),o=pc.math.clamp(this.lerpCamPos.z,this.cameraClampZ.x,this.cameraClampZ.y);this.entity.setPosition(e,this.lerpCamPos.y,o)},CameraController.prototype.startAnimation=function(t,a){if(this.isAnimating=!0,this.pathRoot=this.cameraPathHolder.children[t],this.pathRoot.children[0].setPosition(this.entity.getPosition().clone()),this.pathRoot.children[0].setRotation(this.entity.getRotation().clone()),this.time=0,this.pathData=CameraUtils.getPathData(this.pathRoot),this.callback=a,0==t){let t=2,a={value:this.entity.camera.orthoHeight};this.app.tween(a).to({value:this.entity.camera.orthoHeight+t},this.duration,pc.SineInOut).on("update",(()=>{this.entity.camera.orthoHeight=a.value})).on("complete",(()=>{})).start()}},CameraController.prototype.updateAnimation=function(t){this.time+=t;let a=this.time/this.duration;this.entity.setPosition(this.pathData.px.value(a),this.pathData.py.value(a),this.pathData.pz.value(a)),this.lookAt.set(this.pathData.tx.value(a),this.pathData.ty.value(a),this.pathData.tz.value(a)),this.up.set(this.pathData.ux.value(a),this.pathData.uy.value(a),this.pathData.uz.value(a)),this.entity.lookAt(this.lookAt,this.up),a>=1&&this.stopAnimation()},CameraController.prototype.stopAnimation=function(){this.isAnimating&&(this.isAnimating=!1,this.callback&&(this.callback(),this.callback=null))},CameraController.prototype.resetAnimation=function(){this.isAnimating||CameraUtils.initFollowMode(this.app,this.globalScript.camera,this.globalScript.player,2)},CameraController.prototype.teleport=function(t){let a=(new pc.Vec3).add2(t,this.globalScript.camera.followPlayerOffset);this.entity.setPosition(a.x,a.y,a.z)};var CameraUtils=pc.createScript("cameraUtils");CameraUtils.initFollowMode=function(t,e,o,n,a){if(e.followPlayer)return;let i=(new pc.Vec3).add2(o.entity.getLocalPosition(),e.followPlayerOffset),l=e.entity,c=l.getLocalRotation().clone(),r=l.clone();r.setPosition(i),r.lookAt(o.entity.getLocalPosition());let s=r.getLocalRotation().clone();l.tween(l.getLocalPosition()).to({x:i.x,y:i.y,z:i.z},n,pc.SineInOut).start();let p={x:0,zoom:l.camera.orthoHeight};t.tween(p).to({x:1,zoom:e.initOrthoHeight},n,pc.SineInOut).on("update",(()=>{let t=(new pc.Quat).slerp(c,s,p.x);l.setLocalRotation(t),e.entity.camera.orthoHeight=p.zoom})).on("complete",(()=>{l.setLocalRotation(s),e.followPlayer=!0,o.enableNavigation=!0,a&&a()})).start()},CameraUtils.initDirectFollowMode=function(t,e,o,n,a){if(e.followPlayer)return;let i=(new pc.Vec3).add2(o.entity.getLocalPosition(),e.followPlayerOffset),l=e.entity,c=(l.getLocalRotation().clone(),l.clone());c.setPosition(i),c.lookAt(o.entity.getLocalPosition());let r=c.getLocalRotation().clone();l.setLocalRotation(r),e.entity.camera.orthoHeight=e.initOrthoHeight,e.followPlayer=!0,o.enableNavigation=!0,a&&a()},CameraUtils.initIntroMode=function(t,e,o,n,a){if(e.followPlayer)return;let i=(new pc.Vec3).add2(a.getLocalPosition(),e.followPlayerOffset),l=e.entity,c=l.getLocalRotation().clone(),r=l.clone();r.setPosition(i),r.lookAt(a.getLocalPosition());let s=r.getLocalRotation().clone();l.tween(l.getLocalPosition()).to({x:i.x,y:i.y,z:i.z},n,pc.SineInOut).start();let p={x:0};t.tween(p).to({x:1},n,pc.SineInOut).on("update",(()=>{let t=(new pc.Quat).slerp(c,s,p.x);l.setLocalRotation(t)})).on("complete",(()=>{l.setLocalRotation(s),t.fire("doneInitIntroMode")})).start()},CameraUtils.enableCamera=function(t,e){"Camera"==e.name?(t.camera.endingEntity.enabled=!1,t.camera.entity.enabled=!0):(t.camera.entity.enabled=!1,t.camera.endingEntity.enabled=!0)},CameraUtils.initEndingMode=function(t,e,o=0,n=null){this.enableCamera(e,e.camera.endingEntity);let a=e.camera.endingEntity,i=new pc.Vec3(19.144,19.641,207.799);if(0==o)return a.setLocalPosition(i),a.camera.fov=45,void(n&&n());a.tween(a.getLocalPosition()).to({x:i.x,y:i.y,z:i.z},o,pc.Linear).start();let l={x:5};t.tween(l).to({x:45},o,pc.CircularIn).on("update",(()=>{a.camera.fov=l.x})).on("complete",(()=>{a.camera.fov=l.x,n&&n()})).start()},CameraUtils.initZoneFocusMode=function(t,e,o,n,a){let i=e.camera,l=e.player,c=i.entity,r=c.camera;i.followPlayer=!1,l.enableNavigation=!1;let s=e.state.isMobile,p=e.zoneView[a],d=p.offset,y=s?p.lookAtOffsetMobile:p.lookAtOffsetPC,u=s?p.zoomOffsetMobile:p.zoomOffsetPC,f=(new pc.Vec3).add2(o.getPosition(),d),g=(new pc.Vec3).add2(o.getPosition(),y),m=r.orthoHeight+u;c.tween(c.getLocalPosition()).to({x:f.x,y:f.y,z:f.z},2,pc.SineInOut).on("complete",(()=>{n()})).start();let w=c.clone();w.setPosition(f),w.lookAt(g);let P=c.getLocalRotation().clone(),L=w.getLocalRotation().clone(),C={rotation:0,zoom:r.orthoHeight};t.tween(C).to({rotation:1,zoom:m},2,pc.SineInOut).on("update",(()=>{let t=(new pc.Quat).slerp(P,L,C.rotation);c.setLocalRotation(t),r.orthoHeight=C.zoom})).on("complete",(()=>{c.setLocalRotation(L)})).start()},CameraUtils.getPathData=function(t){let e=pc.CURVE_CARDINAL,o=new pc.Curve;o.type=e;let n=new pc.Curve;n.type=e;let a=new pc.Curve;a.type=e;let l=new pc.Curve;l.type=e;let c=new pc.Curve;c.type=e;let r=new pc.Curve;r.type=e;let s=new pc.Curve;s.type=e;let p=new pc.Curve;p.type=e;let d=new pc.Curve;d.type=e;let y=t.children,u=0,f=[],g=new pc.Vec3;for(f.push(0),i=1;i<y.length;i++){let t=y[i-1],e=y[i];g.sub2(t.getPosition(),e.getPosition()),u+=g.length(),f.push(u)}for(i=0;i<y.length;i++){let t=f[i]/u,e=y[i],g=e.getPosition();o.add(t,g.x),n.add(t,g.y),a.add(t,g.z);let m=g.clone().add(e.forward);l.add(t,m.x),c.add(t,m.y),r.add(t,m.z);let w=e.up;s.add(t,w.x),p.add(t,w.y),d.add(t,w.z)}return{px:o,py:n,pz:a,tx:l,ty:c,tz:r,ux:s,uy:p,uz:d}};var Utils=pc.createScript("utils");Utils.map=function(t,i,r,c,a){return(t-i)*(a-c)/(r-i)+c};var BlockRaycast=pc.createScript("blockRaycast");BlockRaycast.prototype.initialize=function(){this.entity.button.on("mousedown",(function(t){t.stopPropagation()})),this.entity.button.on("touchstart",(function(t){t.stopPropagation()}))};var UiSpriteAnimation=pc.createScript("uiSpriteAnimation");UiSpriteAnimation.attributes.add("playOnStart",{type:"boolean",default:!1}),UiSpriteAnimation.attributes.add("loop",{type:"boolean",default:!1}),UiSpriteAnimation.attributes.add("framesPerSecond",{type:"number",default:1}),UiSpriteAnimation.attributes.add("frameCount",{type:"number",default:1}),UiSpriteAnimation.attributes.add("resetOnStop",{type:"boolean",default:!1}),UiSpriteAnimation.prototype.initialize=function(){this.element=this.entity.element,this.duration=this.framesPerSecond/60,this.time=0,this.frame=0,this.playAnimation=this.playOnStart},UiSpriteAnimation.prototype.update=function(t){this.playAnimation&&(this.time+=t,this.time>=this.duration&&(this.frame++,this.element.spriteFrame=this.frame%this.frameCount,this.time=0,!this.loop&&this.frame>=this.frameCount-1&&this.stop(this.resetOnStop)))},UiSpriteAnimation.prototype.play=function(t=!1){t&&this.reset(),this.playAnimation=!0},UiSpriteAnimation.prototype.stop=function(t=!1){t&&this.reset(),this.playAnimation=!1},UiSpriteAnimation.prototype.reset=function(){this.time=0,this.frame=0,this.element.spriteFrame=0};var FadeGroup=pc.createScript("fadeGroup");FadeGroup.attributes.add("duration",{type:"number",default:.3}),FadeGroup.attributes.add("useThickness",{type:"boolean",default:!1}),FadeGroup.attributes.add("useParent",{type:"boolean",default:!1}),FadeGroup.attributes.add("isSprite",{type:"boolean",default:!1}),FadeGroup.prototype.initialize=function(){},FadeGroup.prototype.init=function(){this.targets=[],this.initOpacity=[],this.initTargets(this.entity),this.isInitialized=!0},FadeGroup.prototype.start=function(t,e=this.duration){this.isInitialized||this.init(),t&&(this.entity.enabled=!0);for(let i=0;i<this.targets.length;i++){let s=this.targets[i];if(!s.element&&!s.sprite)continue;t&&(s.enabled=!0);let n=this.isSprite?s.sprite:s.element;s.tween(n).to({opacity:t?this.initOpacity[i]:0},e,pc.SineInOut).on("update",(()=>{this.isSprite||this.useThickness&&"text"==s.element.type&&(s.element.outlineThickness=s.element.opacity)})).on("complete",(()=>{t||(s.enabled=!1,this.entity.enabled=!1)})).start()}},FadeGroup.prototype.initTargets=function(t){this.useParent&&(this.targets.push(this.entity),this.isSprite?this.initOpacity.push(this.entity.sprite.opacity):this.initOpacity.push(this.entity.element.opacity));for(let e=0;e<t.children.length;e++){let i=t.children[e];i.children.length>0&&(this.isSprite?i.sprite&&(this.targets.push(i),this.initOpacity.push(i.element.opacity)):i.element&&i.element.opacity&&(i.element.mask||(this.targets.push(i),this.initOpacity.push(i.element.opacity))),this.initTargets(i))}};var MaskController=pc.createScript("maskController");MaskController.attributes.add("width",{type:"boolean",default:!0}),MaskController.attributes.add("height",{type:"boolean",default:!0}),MaskController.attributes.add("duration",{type:"number",default:2}),MaskController.attributes.add("hideOnStart",{type:"boolean",default:!0}),MaskController.attributes.add("delayOnStart",{type:"number",default:0}),MaskController.prototype.initialize=function(){this.mask=this.entity.element,this.max=this.mask.width,this.isAnimating=!1,this.hideOnStart&&this.reset()},MaskController.prototype.enable=function(t,i){this.isAnimating||this.mask.width==this.max&&this.mask.height==this.max||(this.isAnimating=!0,setTimeout((()=>{let e={value:t?0:this.mask.width};this.app.tween(e).to({value:t?this.max:0},this.duration,pc.SineInOut).on("update",(()=>{this.mask.width=this.width?e.value:this.max,this.mask.height=this.height?e.value:this.max})).on("complete",(()=>{this.isAnimating=!1})).start(),i&&i()}),1e3*this.delayOnStart))},MaskController.prototype.reset=function(){this.mask.width=0,this.mask.height=0};var FadeController=pc.createScript("fadeController");FadeController.attributes.add("appRoot",{type:"entity"}),FadeController.attributes.add("triggerDistance",{type:"number",default:1}),FadeController.attributes.add("fadeDuration",{type:"number",default:1}),FadeController.attributes.add("fadeOutOnStart",{type:"boolean",default:!0}),FadeController.attributes.add("loop",{type:"boolean",default:!1}),FadeController.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.player=this.globalScript.player.entity,this.target=this.entity.sprite?this.entity.sprite:this.entity.element,this.tweenFrom={x:0},this.tweenTo={x:1},this.tween=this.app.tween(this.tweenFrom).to(this.tweenTo,this.fadeDuration,pc.SineInOut).on("update",(()=>{this.target.opacity=this.tweenFrom.x})),this.fadeOutOnStart&&(this.target.opacity=0)},FadeController.prototype.update=function(t){if(!this.globalScript.player.enableNavigation)return;this.entity.getPosition().distance(this.player.getPosition())<this.triggerDistance?0==this.target.opacity&&(this.tween.stop(),this.tweenFrom.x=0,this.tweenTo.x=1,this.tween.start()):1==this.target.opacity&&this.loop&&(this.tween.stop(),this.tweenFrom.x=1,this.tweenTo.x=0,this.tween.start())};var DynamicSpriteColor=pc.createScript("dynamicSpriteColor");DynamicSpriteColor.attributes.add("appRoot",{type:"entity"}),DynamicSpriteColor.attributes.add("startPosition",{type:"number"}),DynamicSpriteColor.attributes.add("endPosition",{type:"number"}),DynamicSpriteColor.attributes.add("startColor",{type:"rgb"}),DynamicSpriteColor.attributes.add("destColor",{type:"rgb"}),DynamicSpriteColor.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.player=this.globalScript.player.entity,this.sprite=this.entity.sprite},DynamicSpriteColor.prototype.update=function(t){let i=this.player.getPosition().z;if(this.startPosition<=i&&i<=this.endPosition){let t=Utils.map(i,this.startPosition,this.endPosition,0,1);this.sprite.color=this.sprite.color.lerp(this.startColor,this.destColor,t)}};var Blinking=pc.createScript("blinking");Blinking.attributes.add("speed",{type:"number",default:1}),Blinking.attributes.add("delayOnStart",{type:"number",default:0}),Blinking.prototype.initialize=function(){this.opacity=this.entity.element.opacity,this.stopTween=!1,this.delayTimeout=null;let t={opacity:1};this.tween=this.app.tween(t).to({opacity:0},this.speed,pc.SineInOut).on("update",(()=>{this.entity.element.opacity=t.opacity,this.stopTween&&this.entity.element.opacity>=1&&this.tween.stop()})).loop(!0).yoyo(!0),this.delayOnStart?this.delayTimeout=setTimeout((()=>{this.tween.start()}),1e3*this.delayOnStart):this.tween.start()},Blinking.prototype.stop=function(){this.stopTween=!0,this.delayTimeout&&clearTimeout(this.delayTimeout)};var Idling=pc.createScript("idling");Idling.attributes.add("speed",{type:"number",default:1}),Idling.attributes.add("amount",{type:"number",default:.1}),Idling.attributes.add("delayOnStart",{type:"number",default:0}),Idling.attributes.add("playOnEnable",{type:"boolean",default:!0}),Idling.attributes.add("loop",{type:"boolean",default:!0}),Idling.attributes.add("yoyo",{type:"boolean",default:!0}),Idling.attributes.add("smooth",{type:"boolean",default:!0}),Idling.attributes.add("lookAtCamera",{type:"boolean",default:!1}),Idling.attributes.add("appRoot",{type:"entity"}),Idling.prototype.initialize=function(){this.tween=null,this.delayTimeout=null,this.prevEnabled=!1,this.initPosition=this.entity.getLocalPosition().clone(),this.initRotation=this.entity.getLocalEulerAngles().clone(),this.isInitialized=!1,this.data={value:0},this.tween=this.app.tween(this.data).to({value:this.amount},this.speed,pc.SineInOut).on("update",(()=>{this.smooth?this.entity.setLocalPosition(this.entity.getLocalPosition().x,this.initPosition.y+this.data.value,this.entity.getLocalPosition().z):0!=this.data.value&&this.data.value!=this.amount||this.entity.setLocalPosition(this.entity.getLocalPosition().x,this.initPosition.y+this.data.value,this.entity.getLocalPosition().z)})).loop(this.loop).yoyo(this.yoyo)},Idling.prototype.update=function(t){if(this.playOnEnable){if(this.lookAtCamera){let t=this.appRoot.script.global.camera.entity;this.entity.lookAt(t.getPosition())}this.entity.enabled&&!this.prevEnabled&&(this.delayTimeout||(this.delayTimeout=setTimeout((()=>{this.entity.setLocalPosition(this.initPosition.x,this.initPosition.y,this.initPosition.z),this.tween.start(),this.delayTimeout=null}),1e3*this.delayOnStart))),this.prevEnabled=this.entity.enabled}},Idling.prototype.play=function(){this.tween.start()},Idling.prototype.stop=function(){this.tween.stop()};var PlayerAnimationController=pc.createScript("playerAnimationController");PlayerAnimationController.attributes.add("appRoot",{type:"entity",title:"App Root Entity"}),PlayerAnimationController.attributes.add("playerPathHolder",{type:"entity"}),PlayerAnimationController.attributes.add("duration",{type:"number",default:10}),PlayerAnimationController.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.playerController=this.globalScript.player.entity.script.playerController,this.playerEntity=this.globalScript.player.entity,this.playerModel=this.globalScript.player.entity.children[0],this.callback=null,this.time=0,this.isAnimating=!1,this.pathRoot=null,this.pathData=null,this.up=new pc.Vec3,this.lookAt=new pc.Vec3},PlayerAnimationController.prototype.update=function(t){this.isAnimating&&this.updateAnimation(t)},PlayerAnimationController.prototype.startAnimation=function(t,i){this.isAnimating=!0,this.pathRoot=this.playerPathHolder.children[t],this.time=0,this.pathData=CameraUtils.getPathData(this.pathRoot),this.callback=i,"run"!=this.playerModel.anim.baseLayer.activeState&&this.playerModel.anim.setTrigger("run")},PlayerAnimationController.prototype.updateAnimation=function(t){this.time+=t;let i=this.time/this.duration,a=new pc.Vec3(this.pathData.px.value(i),this.pathData.py.value(i),this.pathData.pz.value(i));this.playerController.movePlayerTo(a),i>=1&&this.stopAnimation()},PlayerAnimationController.prototype.stopAnimation=function(){this.isAnimating&&(this.isAnimating=!1,this.playerController.rotate(new pc.Vec3(0,0,100)),this.callback&&(this.callback(),this.callback=null))};var FloorInteractionController=pc.createScript("floorInteractionController");FloorInteractionController.attributes.add("appRoot",{type:"entity"}),FloorInteractionController.attributes.add("triggerDistance",{type:"number",default:10}),FloorInteractionController.attributes.add("intro",{type:"entity"}),FloorInteractionController.attributes.add("main",{type:"entity"}),FloorInteractionController.attributes.add("soundClip",{type:"string"}),FloorInteractionController.attributes.add("button",{type:"entity"}),FloorInteractionController.attributes.add("result",{type:"entity"}),FloorInteractionController.attributes.add("pen",{type:"entity"}),FloorInteractionController.attributes.add("buttons",{type:"entity"}),FloorInteractionController.attributes.add("pens",{type:"entity"}),FloorInteractionController.attributes.add("checks",{type:"entity"}),FloorInteractionController.attributes.add("result2",{type:"entity"}),FloorInteractionController.prototype.initialize=function(){switch(this.globalScript=this.appRoot.script.global,this.uiManager=this.globalScript.managers.uiManager.script.uiManager,this.soundManager=this.globalScript.managers.soundManager.script.soundManager,this.player=this.globalScript.player.entity,this.isTriggered=!1,this.prevIsTriggered=!1,this.isOnInteraction=!1,this.initPenPosition=null,this.tap=0,this.timer=null,this.main&&"animated"==this.main.sprite.type&&(this.mainClip=this.main.sprite.clips.default,this.mainClip.stop()),this.intro&&"animated"==this.intro.sprite.type&&(this.introClip=this.intro.sprite.clips.default,this.introClip.stop()),this.result&&this.result.script.fadeGroup.start(!1,0),this.button&&(this.button.enabled=!1),this.pen&&(this.pen.enabled=!1),this.entity.name){case"plan":break;case"drawing":this.button.button.on("click",(function(t){this.result.enabled||this.buttonClicked()}),this);break;case"dance":let t=this.result.getLocalScale().clone(),i=this.globalScript.state.isMobile?1.2*t.x:.8*t.x;this.result.setLocalScale(i,t.y,t.z),this.app.on("playerDoneMovingOnDance",(()=>{let t=this.entity.children[2].children[0].getPosition();this.player.script.playerController.rotate(t,.5),this.player.script.playerController.changeAnimation("dance"),this.uiManager.playerMarker.enabled=!1,this.showResult()}));break;case"catch":this.main.enabled=!1,this.button.button.on("click",(function(t){this.buttonClicked()}),this);break;case"potato":this.pens.children[0].enabled=!1,this.checks.children.forEach((t=>{t.enabled=!1}));for(let t=0;t<this.buttons.children.length;t++){let i=this.buttons.children[t];i.enabled=!1,i.button.on("click",(function(i){this.result.enabled||this.buttonClicked(t)}),this)}break;case"quiz":this.pens.children[0].enabled=!1,this.checks.children.forEach((t=>{t.enabled=!1})),this.main.enabled=!1,this.tap=-1;for(let t=0;t<this.buttons.children.length;t++){let i=this.buttons.children[t];i.enabled=!1,i.button.on("click",(function(i){this.result.enabled||1!=this.tap&&this.buttonClicked(t)}),this)}}},FloorInteractionController.prototype.update=function(t){if(!this.globalScript.player.enableNavigation)return;let i=this.player.getPosition().distance(this.entity.getPosition());this.isTriggered=i<this.triggerDistance,this.isTriggered&&!this.previsTriggered?this.triggerIn():!this.isTriggered&&this.previsTriggered&&this.triggerOut(),this.previsTriggered=this.isTriggered},FloorInteractionController.prototype.triggerIn=function(){if(!this.isOnInteraction)switch(this.isOnInteraction=!0,this.uiManager.enablePlayerMarker(!0,6),this.soundManager.playClip("alertMark",!0),this.entity.name){case"plan":this.mainClip.play(),this.introClip.play(),this.timer=setTimeout((()=>{this.showResult(),this.timer=null}),2e3);break;case"drawing":this.intro.sprite.frame=0,this.main.sprite.frame=0,this.button.enabled=!0,this.introClip.play(),this.pen.enabled=!0;break;case"dance":this.mainClip.play(),this.soundManager.playClip(this.soundClip,!0),this.soundManager.changeVolume(this.soundManager.currentBgm(),.1,!0),this.globalScript.player.enableNavigation=!1;let t=this.entity.children[2].getPosition();this.player.script.playerController.movePlayerTo(t,100);break;case"catch":this.button.enabled=!0,this.introClip.play(),this.pen.enabled=!0;break;case"potato":for(let t=0;t<this.buttons.children.length;t++)this.buttons.children[t].enabled=!this.checks.children[t].enabled;this.introClip.play(),this.pen.enabled=!0;break;case"quiz":this.checks.children[1].enabled&&(this.pens.children[0].enabled=!1,this.checks.children.forEach((t=>{t.enabled=!1})));for(let t=0;t<this.buttons.children.length;t++)this.buttons.children[t].enabled=!this.checks.children[t].enabled;this.introClip.play(),this.pen.enabled=!0}},FloorInteractionController.prototype.triggerOut=function(){switch(this.uiManager.enablePlayerMarker(!0,0),this.entity.name){case"plan":this.timer&&(clearTimeout(this.timer),this.isOnInteraction=!1),this.mainClip.stop(),this.introClip.stop(),this.main.sprite.frame=0,this.intro.sprite.frame=0;break;case"drawing":this.timer&&(clearTimeout(this.timer),this.tap=0),0==this.tap&&(this.isOnInteraction=!1),this.introClip.stop(),this.intro.sprite.frame=0,this.mainClip.stop(),this.main.sprite.frame=0,this.pen.enabled=!1,this.button.enabled=!1;break;case"dance":this.mainClip.stop(),this.main.sprite.frame=0;break;case"catch":0==this.tap&&(this.isOnInteraction=!1),this.intro.enabled=!0,this.introClip.stop(),this.intro.sprite.frame=0,this.main.enabled=!1,this.pen.enabled=!1,this.button.enabled=!1;break;case"potato":this.tap<3&&(this.isOnInteraction=!1),this.introClip.stop(),this.intro.sprite.frame=0,this.buttons.children.forEach((t=>{t.enabled=!1})),0==this.tap&&(this.pens.children[0].enabled=!1,this.checks.children.forEach((t=>{t.enabled=!1}))),this.pen.enabled=!1;break;case"quiz":1!=this.tap&&(this.isOnInteraction=!1),this.intro.enabled=!0,this.introClip.stop(),this.intro.sprite.frame=0,this.main.enabled=!1,this.buttons.children.forEach((t=>{t.enabled=!1})),-1==this.tap&&(this.pens.children[0].enabled=!1,this.checks.children.forEach((t=>{t.enabled=!1}))),this.pen.enabled=!1}},FloorInteractionController.prototype.buttonClicked=function(t){switch(this.entity.name){case"drawing":this.soundManager.playClip("click"),this.tap++,this.button.enabled=!1,this.pen.enabled=!1,this.mainClip.play(),this.soundManager.playClip("drawing"),this.timer=setTimeout((()=>{this.showResult(),this.introClip.stop(),this.timer=null}),2e3);break;case"catch":this.soundManager.playClip("click"),this.tap++,this.button.enabled=!1,this.pen.enabled=!1,this.introClip.stop(),this.main.enabled=!0,this.intro.enabled=!1,this.soundManager.playClip("catch"),this.showResult();break;case"potato":this.soundManager.playClip("click"),this.pen.enabled=!1,this.pens.children[0].enabled=!0;let i=this.pens.children[t+1].getPosition();this.pens.children[0].setPosition(i.x,i.y,i.z),this.checks.children[t].enabled=!0,this.buttons.children[t].enabled=!1,this.tap++,this.tap>=3&&this.showResult();break;case"quiz":let e=this.pens.children[t+1].getPosition();this.pens.children[0].setPosition(e.x,e.y,e.z),this.checks.children[t].enabled=!0,this.buttons.children[t].enabled=!1,this.intro.enabled=!1,this.pen.enabled=!1,this.pens.children[0].enabled=!0,this.main.enabled=!0,this.main.sprite.frame=t,this.tap=t,1==t?(this.showResult(),this.soundManager.playClip("quizO")):this.soundManager.playClip("quizX")}},FloorInteractionController.prototype.showResult=function(){switch(this.entity.name){case"plan":this.result.enabled=!0;let t=0,i=setInterval((()=>{this.result.children[t].element.opacity=1,this.result.children[t].enabled=!0,t++,t>=this.result.children.length&&(clearInterval(i),this.result.children.forEach((t=>{t.script.uiSpriteAnimation.play(),setTimeout((()=>{t.script.uiSpriteAnimation.stop(),this.result.script.fadeGroup.start(!1),this.isOnInteraction=!1}),2e3)})))}),500);break;case"drawing":this.result.script.fadeGroup.start(!0),this.result.script.uiSpriteAnimation.play(!0),setTimeout((()=>{this.result.script.fadeGroup.start(!1),this.tap=0,this.isOnInteraction=!1}),3300);break;case"dance":this.result.script.fadeGroup.start(!0),this.result.script.uiSpriteAnimation.play(),setTimeout((()=>{this.result.script.fadeGroup.start(!1),this.result.script.uiSpriteAnimation.stop(!0),this.soundManager.playClip(this.soundClip,!1,!0),this.soundManager.changeVolume(this.soundManager.currentBgm(),"default",!0),this.isOnInteraction=!1,this.player.script.playerController.changeAnimation("idle"),this.globalScript.player.enableNavigation=!0,this.uiManager.playerMarker.enabled=!0}),9e3);break;case"catch":this.result.script.fadeGroup.start(!0),setTimeout((()=>{this.result2.script.fadeGroup.start(!0),this.result2.children[0].script.uiSpriteAnimation.play(!0)}),500),setTimeout((()=>{this.result.script.fadeGroup.start(!1),this.result2.script.fadeGroup.start(!1),this.tap=0,this.isOnInteraction=!1}),2e3);break;case"potato":this.result.script.fadeGroup.start(!0),this.result.children.forEach((t=>{t.script.uiSpriteAnimation.play()})),setTimeout((()=>{this.result.script.fadeGroup.start(!1),this.result.children.forEach((t=>{t.script.uiSpriteAnimation.stop(!0)})),this.soundManager.playClip("potato"),this.showPotatoRain((()=>{this.tap=0,this.isOnInteraction=!1}))}),3e3);break;case"quiz":this.buttons.children.forEach((t=>{t.enabled=!1})),this.result.script.fadeGroup.start(!0),this.result.script.uiSpriteAnimation.play(!0);let e=this.globalScript.state.isMobile?2:1.3,s=this.globalScript.state.isMobile?3:5,n=this.result.getPosition().clone(),r={value:e};this.app.tween(r).to({value:-e},s,pc.SineInOut).on("update",(()=>{this.result.setPosition(r.value,n.y,n.z)})).on("complete",(()=>{this.result.script.fadeGroup.start(!1),this.result.script.uiSpriteAnimation.stop(),this.tap=-1,this.isOnInteraction=!1})).start()}},FloorInteractionController.prototype.showPotatoRain=function(t){this.result2.enabled=!0;let i={value:1300};this.app.tween(i).to({value:-1300},2,pc.SineInOut).on("update",(()=>{this.result2.setLocalPosition(0,i.value,0)})).on("complete",(()=>{this.result2.enabled=!1,t&&t()})).start()};var BathroomGameUicontroller=pc.createScript("bathroomGameUicontroller");BathroomGameUicontroller.attributes.add("appRoot",{type:"entity"}),BathroomGameUicontroller.attributes.add("scoreHolder",{type:"entity"}),BathroomGameUicontroller.attributes.add("playerHolder",{type:"entity"}),BathroomGameUicontroller.attributes.add("octoHolder",{type:"entity"}),BathroomGameUicontroller.attributes.add("winHolder",{type:"entity"}),BathroomGameUicontroller.attributes.add("replayHolder",{type:"entity"}),BathroomGameUicontroller.attributes.add("score",{type:"entity"}),BathroomGameUicontroller.attributes.add("scoreShadow",{type:"entity"}),BathroomGameUicontroller.attributes.add("playerHealth",{type:"entity"}),BathroomGameUicontroller.attributes.add("octoHealth",{type:"entity"}),BathroomGameUicontroller.attributes.add("distanceThreshold",{type:"number"}),BathroomGameUicontroller.attributes.add("point",{type:"number"}),BathroomGameUicontroller.attributes.add("damage",{type:"number"}),BathroomGameUicontroller.attributes.add("center",{type:"entity"}),BathroomGameUicontroller.attributes.add("shake",{type:"json",schema:[{name:"use",type:"boolean",default:!0},{name:"target",type:"number",enum:[{CAMERA:0},{ENTITY:1}],default:0},{name:"interval",type:"number",default:.04},{name:"maxDistance",type:"number",default:.05},{name:"duration",type:"number",default:.5}]}),BathroomGameUicontroller.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.zoneManager=this.globalScript.managers.zoneManager.script.zoneManager,this.soundManager=this.globalScript.managers.soundManager.script.soundManager,this.playerEntity=this.globalScript.player.entity,this.maxAttackCount=4,this.tweenDuration=[1,2,1,3],this.attackCount=0,this.checkForTrigger=!1,this.prevTriggered=!1,this.initWidth=this.playerHealth.element.width,this.isOn=!1,this.isOnReplay=!1,this.enableGameUI(!1),this.replayHolder.script.fadeGroup.start(!1,0),this.shaking=!1,this.shakeTargetEntity=0==this.shake.target?this.globalScript.camera.entity:this.entity,this.shakeTime=0,this.timeSinceLastShake=0,this.startPosition=this.shakeTargetEntity.getLocalPosition().clone(),this.replayHolder.children[0].button.on("click",(t=>{this.reset(),this.zoneManager.resetBathroom(),this.replayHolder.script.fadeGroup.start(!1),this.isOnReplay=!1,this.enableGameUI(!0),this.playSound(!0)}))},BathroomGameUicontroller.prototype.update=function(t){if(this.shake.use&&this.updateShakeEffect(t),!this.checkForTrigger)return;let e=this.playerEntity.getPosition().distance(this.center.getPosition())<=this.distanceThreshold;e&&!this.prevTriggered?(this.isOnReplay&&this.replayHolder.script.fadeGroup.start(!0),this.isOnReplay||this.playSound(!0)):!e&&this.prevTriggered&&(this.isOnReplay&&this.replayHolder.script.fadeGroup.start(!1),this.playSound(!1)),this.prevTriggered=e},BathroomGameUicontroller.prototype.playSound=function(t){t?this.soundManager.isPlaying("zone03-octo")||(this.soundManager.playClip("zone03-octo"),this.soundManager.changeVolume(this.soundManager.currentBgm(),.1,!0)):this.soundManager.isPlaying("zone03-octo")&&(this.soundManager.playClip("zone03-octo",!1,!0),this.soundManager.changeVolume(this.soundManager.currentBgm(),"default",!0))},BathroomGameUicontroller.prototype.enableGameUI=function(t){t&&!this.replayHolder.enabled?this.reset():this.winHolder.script.fadeGroup.start(!1),this.isOn=t,this.scoreHolder.script.fadeGroup.start(t),this.playerHolder.script.fadeGroup.start(t),this.octoHolder.script.fadeGroup.start(t)},BathroomGameUicontroller.prototype.playerAttack=function(){if(!this.isOn)return;if(this.attackCount>=this.maxAttackCount)return;0==this.attackCount?this.soundManager.playClip("zone03-ryanAttackA"):1==this.attackCount?this.soundManager.playClip("zone03-ryanAttackB"):3==this.attackCount&&this.soundManager.playClip("zone03-ryanAttackC"),this.updateHealth(this.octoHealth);let t=Number(this.score.element.text)+this.point,e={value:Number(this.score.element.text)};this.app.tween(e).to({value:t},this.tweenDuration[this.attackCount],pc.SineInOut).on("update",(()=>{let t=Math.round(e.value);this.score.element.text=t,this.scoreShadow.element.text=t})).start(),this.attackCount++},BathroomGameUicontroller.prototype.octoAttack=function(){this.isOn&&(this.attackCount>=this.maxAttackCount||(this.updateHealth(this.playerHealth),this.attackCount++))},BathroomGameUicontroller.prototype.reset=function(){this.playerHealth.element.width=this.initWidth,this.octoHealth.element.width=this.initWidth,this.score.element.text="0",this.scoreShadow.element.text="0",this.attackCount=0},BathroomGameUicontroller.prototype.win=function(){setTimeout((()=>{this.winHolder.script.fadeGroup.start(!0),this.soundManager.playClip("zone03-win")}),5e3),setTimeout((()=>{this.enableGameUI(!1),this.playSound(!1),this.replay(),this.checkForTrigger=!0}),8e3)},BathroomGameUicontroller.prototype.replay=function(){this.replayHolder.script.fadeGroup.start(!0),this.isOnReplay=!0},BathroomGameUicontroller.prototype.updateHealth=function(t){let e=t.element.width-this.damage;t.tween(t.element).to({width:e},this.tweenDuration[this.attackCount],pc.SineInOut).start(),this.shake.use&&this.enableShakeEffect()},BathroomGameUicontroller.prototype.enableShakeEffect=function(){this.shaking=!0,this.shakeTime=0,this.startPosition=this.shakeTargetEntity.getLocalPosition().clone()},BathroomGameUicontroller.prototype.updateShakeEffect=function(t){if(this.shaking)if(this.shakeTime+=t,this.shakeTime<this.shake.duration){if(this.timeSinceLastShake+=t,this.timeSinceLastShake>=this.shake.interval){var e=1-pc.math.clamp(this.shakeTime/this.shake.duration,0,1),a=2*Math.PI*pc.math.random(0,1),i=pc.math.random(0,this.shake.maxDistance)*e+pc.math.random(0,this.shake.maxDistance)*e,o=i>1?2-i:i,r=o*Math.cos(a),s=o*Math.sin(a);this.shakeTargetEntity.setLocalPosition(this.startPosition.x+r,this.startPosition.y+s,this.startPosition.z),this.timeSinceLastShake-=this.shake.interval}}else this.shaking=!1,this.shakeTargetEntity.setLocalPosition(this.startPosition.x,this.startPosition.y,this.startPosition.z)};const VideoTexture=pc.createScript("videoTexture");VideoTexture.attributes.add("video",{type:"asset"}),VideoTexture.attributes.add("loop",{type:"boolean",default:!1}),VideoTexture.attributes.add("autoPlay",{type:"boolean",default:!1}),VideoTexture.attributes.add("useFadeGroup",{type:"boolean",default:!1}),VideoTexture.prototype.initialize=function(){let e=document.createElement("video");e.id="endingVideo",e.autoplay=!1,e.crossOrigin="anonymous",e.loop=this.loop,e.muted=!0,e.playsInline=!0,e.src=this.video.getFileUrl();let t=e.style;t.width="1px",t.height="1px",t.position="absolute",t.opacity="0",t.zIndex="-1000",t.pointerEvents="none",document.body.appendChild(e),this.videoTexture=new pc.Texture(this.app.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!1,autoMipmap:!1}),this.videoTexture.setSource(e),e.addEventListener("loadedmetadata",function(t){this.autoPlay?(e.currentTime=0,e.play()):(this.loaded||(e.currentTime=0,e.play()),this.loaded=!0)}.bind(this)),e.addEventListener("ended",function(e){this.loop||this.start(!1),this.app.fire("endingVideoDone")}.bind(this)),this.loaded=!1,this.playing=!1,this.videoElement=e,this.entity.element.texture=this.videoTexture},VideoTexture.prototype.update=function(e){this.playing&&this.videoTexture.upload()},VideoTexture.prototype.start=function(e){!this.playing&&e?(this.loaded&&(this.videoElement.currentTime=0,this.videoElement.play()),this.useFadeGroup&&this.entity.script.fadeGroup.start(!0)):this.playing&&!e?(this.useFadeGroup&&this.entity.script.fadeGroup.start(!1),this.videoElement.pause()):this.playing&&!e&&this.entity.script.fadeGroup.start(!1),this.playing=e};var FollowTarget=pc.createScript("followTarget");FollowTarget.attributes.add("target",{type:"entity"}),FollowTarget.prototype.initialize=function(){this.prevTargetPosition=null},FollowTarget.prototype.update=function(t){this.prevTargetPosition||(this.prevTargetPosition=this.target.getPosition().clone());let i=this.target.getPosition().clone().sub(this.prevTargetPosition);this.prevTargetPosition.set(this.target.getPosition().x,this.target.getPosition().y,this.target.getPosition().z);let e=this.entity.getPosition().clone(),o=e.add(i);this.entity.setPosition(o.x,e.y,o.z)};var VideoResizer=pc.createScript("videoResizer");VideoResizer.attributes.add("appRoot",{type:"entity"}),VideoResizer.attributes.add("maxHeightMobile",{type:"number",default:900}),VideoResizer.attributes.add("maxHeightPC",{type:"number",default:1280}),VideoResizer.attributes.add("videoSize",{type:"vec2",default:[720,1280]}),VideoResizer.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.app.graphicsDevice.on("resizecanvas",this.onResize,this),this.onResize(this.app.graphicsDevice.width,this.app.graphicsDevice.height)},VideoResizer.prototype.update=function(e){},VideoResizer.prototype.onResize=function(e,i){let t=this.videoSize.x*window.devicePixelRatio,o=this.videoSize.y*window.devicePixelRatio,s=e/this.videoSize.x*this.videoSize.y,d=e;i>s&&(d=i/this.videoSize.y*this.videoSize.x,s=i),(d>t||s>o)&&(s=o,d=t),this.entity.element.width=d,this.entity.element.height=s};const SpriteBatching=pc.createScript("spriteBatching");SpriteBatching.attributes.add("debug",{type:"boolean",default:!1}),SpriteBatching.attributes.add("id",{type:"number",default:100002}),SpriteBatching.prototype.initialize=function(){this.debug?console.log(this.entity.render.batchGroupId):this.entity.sprite.batchGroupId=this.id};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"500px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var LivingroomGameUicontroller=pc.createScript("livingroomGameUicontroller");LivingroomGameUicontroller.attributes.add("appRoot",{type:"entity"}),LivingroomGameUicontroller.attributes.add("distanceThreshold",{type:"number",default:20}),LivingroomGameUicontroller.attributes.add("duration",{type:"number",default:3}),LivingroomGameUicontroller.attributes.add("endingDuration",{type:"number",default:1}),LivingroomGameUicontroller.attributes.add("screen",{type:"entity"}),LivingroomGameUicontroller.attributes.add("speed",{type:"entity"}),LivingroomGameUicontroller.attributes.add("map",{type:"entity"}),LivingroomGameUicontroller.attributes.add("ending",{type:"entity"}),LivingroomGameUicontroller.prototype.initialize=function(){this.globalScript=this.appRoot.script.global,this.soundManager=this.globalScript.managers.soundManager.script.soundManager,this.playerEntity=this.globalScript.player.entity,this.checkForTrigger=!1,this.isOn=!1,this.prevTriggered=!1,this.animTargets=[],this.timer=null,this.animTargets.push(this.speed),this.animTargets.push(this.map),this.screen.script.fadeGroup.start(!1,0)},LivingroomGameUicontroller.prototype.enableGameUI=function(i){if(i){if(this.isOn)return;this.isOn=!0,this.screen.script.fadeGroup.start(!0),this.animTargets.forEach((i=>{i.script.uiSpriteAnimation.play()}))}else{if(!this.isOn)return;this.isOn=!1,this.timer=setTimeout((()=>{this.showEnding(),this.timer=null}),1e3*this.duration)}},LivingroomGameUicontroller.prototype.showEnding=function(){this.ending.enabled=!0;let i={value:1300};this.app.tween(i).to({value:-1300},this.endingDuration,pc.SineInOut).on("update",(()=>{this.ending.setLocalPosition(0,i.value,0)})).on("complete",(()=>{this.screen.script.fadeGroup.start(!1),this.animTargets.forEach((i=>{i.script.uiSpriteAnimation.stop(!0)})),this.ending.enabled=!1,this.checkForTrigger=!0,this.prevTriggered=!0})).start()},LivingroomGameUicontroller.prototype.update=function(i){if(!this.checkForTrigger)return;let t=this.playerEntity.getPosition().distance(this.entity.getPosition())<=this.distanceThreshold;t&&!this.prevTriggered?this.soundManager.isPlaying("zone02-racing")||this.soundManager.playClip("zone02-racing"):!t&&this.prevTriggered&&this.soundManager.isPlaying("zone02-racing")&&this.soundManager.playClip("zone02-racing",!1,!0),this.prevTriggered=t};var FadeMaterialDiffuseTint=pc.createScript("fadeMaterialDiffuseTint");FadeMaterialDiffuseTint.attributes.add("material",{type:"asset",assetType:"material"}),FadeMaterialDiffuseTint.attributes.add("colors",{type:"rgb",array:!0}),FadeMaterialDiffuseTint.attributes.add("duration",{type:"number",default:1}),FadeMaterialDiffuseTint.attributes.add("defaultColor",{type:"rgb"}),FadeMaterialDiffuseTint.prototype.initialize=function(){this.timer=null},FadeMaterialDiffuseTint.prototype.updateColor=function(t,e=0){this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{let e=this.material.resource,i=e.emissive.clone(),a=-1==t?this.defaultColor:this.colors[t];this.app.tween(i).to(a,this.duration,pc.Linear).on("update",(function(){e.emissive=i,e.update()})).start()}),e)};var UvAnimation=pc.createScript("uvAnimation");UvAnimation.attributes.add("material",{type:"asset",assetType:"material"}),UvAnimation.attributes.add("speed",{type:"vec2",default:[0,1]}),UvAnimation.prototype.initialize=function(){this.isOn=!1,this.velocity=new pc.Vec2,this.offset=new pc.Vec2},UvAnimation.prototype.update=function(t){this.isOn&&(this.velocity.set(this.speed.x,this.speed.y),this.velocity.scale(t),this.offset.copy(this.material.resource.opacityMapOffset),this.offset.add(this.velocity),this.material.resource.opacityMapOffset=this.offset,this.material.resource.update())},UvAnimation.prototype.start=function(){this.isOn=!0};